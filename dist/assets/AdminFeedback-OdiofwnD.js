import{u as ie,a as ne,r as c,j as e,L as oe,q as ce,c as de,d as f,k as ge,g as xe,e as S,b as O,n as me}from"./index-C076F-ZT.js";import{R as q}from"./refresh-cw-DOykDcID.js";import{D as ue}from"./download-DABJJ_FV.js";import{M as V}from"./message-circle-pXEd7tuw.js";import{C as he}from"./clock-CvhsIL_s.js";import{C as ye}from"./circle-check-big-ZK3orgyH.js";import{S as z}from"./star-D2WETixx.js";import{T as pe,A as H}from"./triangle-alert-Dq5E0Yfw.js";import{m as $}from"./proxy-D6WxFS99.js";import{S as be}from"./search-BTMta1m_.js";import{U as G}from"./user-C-fz98gT.js";import{F as je,C as ve,R as Q}from"./reply-BcEiknBM.js";import{T as we}from"./tag-CQsWa-DN.js";import{T as Ne}from"./trash-2-CUDs3oDb.js";import"./createLucideIcon-ykQfwTyC.js";const Ue=()=>{const{darkMode:r}=ie(),{user:A}=ne(),[d,j]=c.useState([]),[C,D]=c.useState(!0),[g,T]=c.useState(null),[n,v]=c.useState({status:"all",category:"all",priority:"all",rating:"all",dateRange:"30d"}),[x,W]=c.useState(""),[h,Y]=c.useState("createdAt"),[R,I]=c.useState("desc"),[J,y]=c.useState(!1),[p,L]=c.useState(""),[w,m]=c.useState(!1),F=async()=>{try{D(!0);const t=ce(de(f,"feedbacks"),ge("createdAt","desc")),l=(await xe(t)).docs.map(a=>{var o;return{id:a.id,...a.data(),createdAt:(o=a.data().createdAt)!=null&&o.toDate?a.data().createdAt.toDate():new Date(a.data().createdAt)}});j(l)}catch(t){console.error("Error fetching feedbacks:",t)}finally{D(!1)}};c.useEffect(()=>{F()},[]);const N=c.useMemo(()=>{let t=d.filter(s=>{var B,M,k,U;const l=x.trim()===""||((B=s.title)==null?void 0:B.toLowerCase().includes(x.toLowerCase()))||((M=s.message)==null?void 0:M.toLowerCase().includes(x.toLowerCase()))||((k=s.userName)==null?void 0:k.toLowerCase().includes(x.toLowerCase()))||((U=s.userEmail)==null?void 0:U.toLowerCase().includes(x.toLowerCase())),a=n.status==="all"||s.status===n.status,o=n.category==="all"||s.category===n.category,i=n.priority==="all"||s.priority===n.priority,u=n.rating==="all"||n.rating==="5"&&s.rating===5||n.rating==="4"&&s.rating===4||n.rating==="3"&&s.rating===3||n.rating==="1-2"&&s.rating<=2,re=new Date,se=s.createdAt;let E=!0;if(n.dateRange!=="all"){const ae=parseInt(n.dateRange.replace("d","")),le=new Date(re.getTime()-ae*24*60*60*1e3);E=se>=le}return l&&a&&o&&i&&u&&E});return t.sort((s,l)=>{let a=s[h],o=l[h];return h==="createdAt"&&(a=a instanceof Date?a:new Date(a),o=o instanceof Date?o:new Date(o)),R==="asc"?a>o?1:-1:a<o?1:-1}),t},[d,x,n,h,R]),b=c.useMemo(()=>{const t=d.length,s=d.filter(i=>i.status==="pending").length,l=d.filter(i=>i.status==="resolved").length,a=d.length>0?(d.reduce((i,u)=>i+(u.rating||0),0)/d.length).toFixed(1):"0.0",o=d.filter(i=>i.priority==="high").length;return{total:t,pending:s,resolved:l,avgRating:a,highPriority:o}},[d]),K=async(t,s)=>{try{m(!0);const l=S(f,"feedbacks",t);await O(l,{status:s,lastUpdated:new Date}),j(a=>a.map(o=>o.id===t?{...o,status:s,lastUpdated:new Date}:o))}catch(l){console.error("Error updating feedback status:",l)}finally{m(!1)}},X=async()=>{if(!(!g||!p.trim()))try{m(!0);const t=S(f,"feedbacks",g.id);await O(t,{adminResponse:p,adminResponseAt:new Date,adminResponseBy:A.email,status:"reviewed"}),j(s=>s.map(l=>l.id===g.id?{...l,adminResponse:p,adminResponseAt:new Date,adminResponseBy:A.email,status:"reviewed"}:l)),y(!1),L(""),T(null)}catch(t){console.error("Error sending admin response:",t)}finally{m(!1)}},Z=async t=>{if(confirm("Are you sure you want to delete this feedback? This action cannot be undone."))try{m(!0),await me(S(f,"feedbacks",t)),j(s=>s.filter(l=>l.id!==t))}catch(s){console.error("Error deleting feedback:",s)}finally{m(!1)}},_=()=>{const s=[["Date","User","Email","Title","Category","Priority","Rating","Status","Message","Admin Response"].join(","),...N.map(i=>{var u;return[((u=i.createdAt)==null?void 0:u.toLocaleDateString())||"N/A",`"${i.userName||"Anonymous"}"`,i.userEmail||"N/A",`"${i.title||""}"`,i.category||"general",i.priority||"medium",i.rating||0,i.status||"pending",`"${(i.message||"").replace(/"/g,'""')}"`,`"${(i.adminResponse||"").replace(/"/g,'""')}"`].join(",")})].join(`
`),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(l);a.setAttribute("href",o),a.setAttribute("download",`feedback-export-${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},P=t=>t?(t instanceof Date?t:new Date(t)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",ee=t=>{switch(t){case"pending":return r?"text-yellow-400 bg-yellow-900/20":"text-yellow-600 bg-yellow-100";case"reviewed":return r?"text-blue-400 bg-blue-900/20":"text-blue-600 bg-blue-100";case"resolved":return r?"text-green-400 bg-green-900/20":"text-green-600 bg-green-100";case"closed":return r?"text-gray-400 bg-gray-900/20":"text-gray-600 bg-gray-100";default:return r?"text-gray-400 bg-gray-900/20":"text-gray-600 bg-gray-100"}},te=t=>{switch(t){case"high":return r?"text-red-400":"text-red-600";case"medium":return r?"text-yellow-400":"text-yellow-600";case"low":return r?"text-green-400":"text-green-600";default:return r?"text-gray-400":"text-gray-600"}};return C?e.jsx("div",{className:`min-h-screen ${r?"bg-gray-900":"bg-gray-50"}`,children:e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:`text-center ${r?"text-gray-400":"text-gray-600"}`,children:[e.jsx(q,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("div",{children:"Loading feedback data..."})]})})})}):e.jsx("div",{className:`min-h-screen ${r?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${r?"text-white":"text-gray-900"}`,children:"Feedback Management"}),e.jsx("p",{className:`mt-1 text-sm ${r?"text-gray-400":"text-gray-500"}`,children:"Review and respond to user feedback and suggestions"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:_,className:`px-4 py-2 rounded-lg text-sm transition-all border ${r?"bg-gray-800 hover:bg-gray-700 text-gray-300 border-gray-600":"bg-white hover:bg-gray-50 text-gray-700 border-gray-300"}`,children:[e.jsx(ue,{className:"h-4 w-4 mr-2 inline"}),"Export CSV"]}),e.jsxs("button",{onClick:F,disabled:C,className:"px-4 py-2 rounded-lg text-sm transition-all bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(q,{className:`h-4 w-4 mr-2 inline ${C?"animate-spin":""}`}),"Refresh"]}),e.jsx(oe,{to:"/admin",className:`px-4 py-2 rounded-lg text-sm transition-all border ${r?"bg-gray-800 hover:bg-gray-700 text-blue-400 border-blue-500/50":"bg-white hover:bg-gray-50 text-blue-600 border-blue-500/50"}`,children:"← Back to Admin"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[{title:"Total Feedback",value:b.total,icon:V,color:"blue"},{title:"Pending Review",value:b.pending,icon:he,color:"yellow"},{title:"Resolved",value:b.resolved,icon:ye,color:"green"},{title:"Average Rating",value:b.avgRating,icon:z,color:"purple"},{title:"High Priority",value:b.highPriority,icon:pe,color:"red"}].map((t,s)=>e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:`p-6 rounded-lg border ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${t.color==="blue"?"bg-blue-100 text-blue-600":t.color==="yellow"?"bg-yellow-100 text-yellow-600":t.color==="green"?"bg-green-100 text-green-600":t.color==="purple"?"bg-purple-100 text-purple-600":"bg-red-100 text-red-600"}`,children:e.jsx(t.icon,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:t.title}),e.jsx("p",{className:`text-2xl font-bold ${r?"text-white":"text-gray-900"}`,children:t.value})]})]})},s))}),e.jsxs("div",{className:`p-6 rounded-lg border ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} mb-6`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 ${r?"text-gray-400":"text-gray-500"}`}),e.jsx("input",{type:"text",placeholder:"Search feedback...",value:x,onChange:t=>W(t.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"} focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]})}),e.jsxs("select",{value:n.status,onChange:t=>v(s=>({...s,status:t.target.value})),className:`px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsxs("select",{value:n.category,onChange:t=>v(s=>({...s,category:t.target.value})),className:`px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"product",children:"Product"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"website",children:"Website"}),e.jsx("option",{value:"delivery",children:"Delivery"}),e.jsx("option",{value:"billing",children:"Billing"}),e.jsx("option",{value:"suggestion",children:"Suggestion"}),e.jsx("option",{value:"complaint",children:"Complaint"})]}),e.jsxs("select",{value:n.priority,onChange:t=>v(s=>({...s,priority:t.target.value})),className:`px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Priority"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:n.rating,onChange:t=>v(s=>({...s,rating:t.target.value})),className:`px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Ratings"}),e.jsx("option",{value:"5",children:"5 Stars"}),e.jsx("option",{value:"4",children:"4 Stars"}),e.jsx("option",{value:"3",children:"3 Stars"}),e.jsx("option",{value:"1-2",children:"1-2 Stars"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:`text-sm ${r?"text-gray-300":"text-gray-700"}`,children:"Sort by:"}),e.jsxs("select",{value:h,onChange:t=>Y(t.target.value),className:`px-3 py-1 rounded border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"createdAt",children:"Date"}),e.jsx("option",{value:"rating",children:"Rating"}),e.jsx("option",{value:"priority",children:"Priority"}),e.jsx("option",{value:"status",children:"Status"})]}),e.jsx("button",{onClick:()=>I(t=>t==="asc"?"desc":"asc"),className:`px-2 py-1 rounded ${r?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:R==="asc"?"↑":"↓"})]})}),e.jsxs("div",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:["Showing ",N.length," of ",d.length," feedback items"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{children:N.map((t,s)=>e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:s*.05},className:`p-6 rounded-lg border ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} hover:shadow-lg transition-shadow`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:`h-4 w-4 ${r?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`font-medium ${r?"text-white":"text-gray-900"}`,children:t.userName||"Anonymous"}),e.jsxs("span",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:["(",t.userEmail,")"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(l=>e.jsx(z,{className:`h-4 w-4 ${l<=(t.rating||0)?"text-yellow-400 fill-current":r?"text-gray-600":"text-gray-300"}`},l)),e.jsxs("span",{className:`ml-1 text-sm ${r?"text-gray-400":"text-gray-500"}`,children:[t.rating||0,"/5"]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ee(t.status)}`,children:t.status||"pending"}),e.jsxs("span",{className:`text-sm font-medium ${te(t.priority)}`,children:[e.jsx(je,{className:"h-3 w-3 inline mr-1"}),t.priority||"medium"]}),e.jsxs("span",{className:`text-xs ${r?"text-gray-500":"text-gray-400"}`,children:[e.jsx(ve,{className:"h-3 w-3 inline mr-1"}),P(t.createdAt)]})]}),e.jsx("h3",{className:`text-lg font-semibold mb-2 ${r?"text-white":"text-gray-900"}`,children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(we,{className:`h-4 w-4 ${r?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`text-sm ${r?"text-gray-400":"text-gray-500"}`,children:t.category||"general"})]}),e.jsx("p",{className:`text-sm mb-4 ${r?"text-gray-300":"text-gray-700"}`,children:t.message}),t.adminResponse&&e.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${r?"bg-blue-900/20 border-blue-400":"bg-blue-50 border-blue-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:`h-4 w-4 ${r?"text-blue-400":"text-blue-600"}`}),e.jsxs("span",{className:`text-sm font-medium ${r?"text-blue-400":"text-blue-600"}`,children:["Admin Response by ",t.adminResponseBy]}),e.jsx("span",{className:`text-xs ${r?"text-blue-300":"text-blue-500"}`,children:P(t.adminResponseAt)})]}),e.jsx("p",{className:`text-sm ${r?"text-blue-200":"text-blue-700"}`,children:t.adminResponse})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[!t.adminResponse&&e.jsxs("button",{onClick:()=>{T(t),y(!0)},className:"px-3 py-1 rounded text-xs font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Q,{className:"h-3 w-3 mr-1 inline"}),"Respond"]}),e.jsxs("select",{value:t.status||"pending",onChange:l=>K(t.id,l.target.value),disabled:w,className:`px-2 py-1 rounded text-xs border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsx("button",{onClick:()=>Z(t.id),disabled:w,className:`px-2 py-1 rounded text-xs transition-colors ${r?"bg-red-600/20 hover:bg-red-600/30 text-red-400":"bg-red-50 hover:bg-red-100 text-red-600"}`,children:e.jsx(Ne,{className:"h-3 w-3"})})]})]})},t.id))}),N.length===0&&e.jsxs("div",{className:`text-center py-12 ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-lg border`,children:[e.jsx(V,{className:`mx-auto h-12 w-12 mb-4 ${r?"text-gray-600":"text-gray-400"}`}),e.jsx("h3",{className:`text-lg font-medium mb-2 ${r?"text-white":"text-gray-900"}`,children:"No feedback found"}),e.jsx("p",{className:`${r?"text-gray-400":"text-gray-500"}`,children:x||Object.values(n).some(t=>t!=="all")?"Try adjusting your search or filters":"No feedback has been submitted yet"})]})]}),e.jsx(H,{children:J&&g&&e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>y(!1),children:e.jsxs($.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:`w-full max-w-2xl rounded-lg border ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:`text-xl font-semibold ${r?"text-white":"text-gray-900"}`,children:"Respond to Feedback"}),e.jsx("button",{onClick:()=>y(!1),className:`p-2 rounded-lg transition-colors ${r?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-500"}`,children:"✕"})]}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${r?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:`h-4 w-4 ${r?"text-gray-400":"text-gray-500"}`}),e.jsxs("span",{className:`font-medium ${r?"text-white":"text-gray-900"}`,children:[g.userName," (",g.userEmail,")"]})]}),e.jsx("h4",{className:`font-medium mb-2 ${r?"text-white":"text-gray-900"}`,children:g.title}),e.jsx("p",{className:`text-sm ${r?"text-gray-300":"text-gray-700"}`,children:g.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"Your Response"}),e.jsx("textarea",{value:p,onChange:t=>L(t.target.value),rows:6,placeholder:"Type your response to the user...",className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500"} focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none`})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:`px-4 py-2 rounded-lg transition-colors ${r?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Cancel"}),e.jsx("button",{onClick:X,disabled:!p.trim()||w,className:"px-4 py-2 rounded-lg transition-colors disabled:opacity-50 bg-blue-600 hover:bg-blue-700 text-white",children:w?"Sending...":"Send Response"})]})]})})})]})})};export{Ue as default};
