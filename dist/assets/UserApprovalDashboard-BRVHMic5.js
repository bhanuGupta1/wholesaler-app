import{a as q,u as Y,r as i,c as G,d as N,q as H,n as J,g as K,j as e,f as Q,e as z,b as W}from"./index-BBVZjf1E.js";const Z=()=>{const{user:w,hasPermission:E}=q(),{darkMode:t}=Y(),[g,$]=i.useState([]),[A,U]=i.useState(!0),[h,T]=i.useState(new Set),[l,m]=i.useState(new Set),[u,F]=i.useState(""),[y,L]=i.useState("pending_approval"),[b,P]=i.useState("all"),[S,R]=i.useState(null),k=E("canApproveUsers")||(w==null?void 0:w.accountType)==="admin";i.useEffect(()=>{k&&M()},[k]);const M=async()=>{try{U(!0);const s=G(N,"users"),a=H(s,J("createdAt","desc")),n=(await K(a)).docs.map(r=>{var c;return{id:r.id,...r.data(),createdAt:((c=r.data().createdAt)==null?void 0:c.toDate())||new Date}});$(n)}catch(s){console.error("Error fetching users:",s),v("Failed to load users","error")}finally{U(!1)}},v=(s,a="success")=>{R({message:s,type:a}),setTimeout(()=>R(null),4e3)},p=i.useMemo(()=>g.filter(s=>{var r,c,x;const a=u.trim()===""||((r=s.displayName)==null?void 0:r.toLowerCase().includes(u.toLowerCase()))||((c=s.email)==null?void 0:c.toLowerCase().includes(u.toLowerCase()))||((x=s.businessName)==null?void 0:x.toLowerCase().includes(u.toLowerCase())),d=y==="all"||s.status===y,n=b==="all"||s.accountType===b;return a&&d&&n}),[g,u,y,b]),o=i.useMemo(()=>{const s={all:g.length,pending_approval:0,approved:0,rejected:0,suspended:0};return g.forEach(a=>{a.status==="pending_approval"?s.pending_approval++:a.approved?s.approved++:a.status==="rejected"?s.rejected++:a.status==="suspended"&&s.suspended++}),s},[g]),f=async(s,a,d=null)=>{if(!h.has(s)){T(n=>new Set(n).add(s));try{const n=z(N,"users",s),r={updatedAt:new Date};switch(a){case"approve":r.approved=!0,r.status="active",r.isActive=!0;const x=g.find(j=>j.id===s);r.permissions=_(x==null?void 0:x.accountType);break;case"reject":r.approved=!1,r.status="rejected",r.isActive=!1;break;case"suspend":r.approved=!1,r.status="suspended",r.isActive=!1;break;case"reactivate":r.approved=!0,r.status="active",r.isActive=!0;break;case"update_status":r.status=d,r.approved=d==="active",r.isActive=d==="active";break}await W(n,r),$(x=>x.map(j=>j.id===s?{...j,...r}:j));const c={approve:"approved",reject:"rejected",suspend:"suspended",reactivate:"reactivated",update_status:`status updated to ${d}`};v(`User ${c[a]} successfully`,"success")}catch(n){console.error(`Error ${a}ing user:`,n),v(`Failed to ${a} user`,"error")}finally{T(n=>{const r=new Set(n);return r.delete(s),r})}}},C=async s=>{if(l.size!==0)try{const a=Q(N),d={updatedAt:new Date};switch(s){case"approve":d.approved=!0,d.status="active",d.isActive=!0;break;case"reject":d.approved=!1,d.status="rejected",d.isActive=!1;break;case"suspend":d.approved=!1,d.status="suspended",d.isActive=!1;break}l.forEach(n=>{const r=z(N,"users",n);if(s==="approve"){const c=g.find(x=>x.id===n);d.permissions=_(c==null?void 0:c.accountType)}a.update(r,d)}),await a.commit(),$(n=>n.map(r=>l.has(r.id)?{...r,...d}:r)),m(new Set),v(`${l.size} users ${s}ed successfully`,"success")}catch(a){console.error(`Error bulk ${s}ing users:`,a),v(`Failed to bulk ${s} users`,"error")}},_=s=>{switch(s){case"manager":return{canCreateOrders:!0,canManageInventory:!0,canViewAllOrders:!0,canApproveUsers:!1,canManageUsers:!1};case"business":return{canCreateOrders:!0,canManageInventory:!1,canViewAllOrders:!1,canApproveUsers:!1,canManageUsers:!1};case"user":default:return{canCreateOrders:!0,canManageInventory:!1,canViewAllOrders:!1,canApproveUsers:!1,canManageUsers:!1}}},B=s=>{const a=new Set(l);a.has(s)?a.delete(s):a.add(s),m(a)},O=()=>{l.size===p.length?m(new Set):m(new Set(p.map(s=>s.id)))},V=s=>{const a=s.status,d=s.approved;return a==="pending_approval"?e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-800"}`,children:"Pending"}):d&&a==="active"?e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:"Approved"}):a==="rejected"?e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-red-900/30 text-red-400":"bg-red-100 text-red-800"}`,children:"Rejected"}):a==="suspended"?e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-gray-900/30 text-gray-400":"bg-gray-100 text-gray-800"}`,children:"Suspended"}):e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-800"}`,children:a||"Unknown"})};return k?A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):e.jsxs("div",{className:`container mx-auto px-4 py-8 max-w-7xl ${t?"text-gray-200":"text-gray-800"}`,children:[S&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${S.type==="success"?t?"bg-green-900 border-green-700 text-green-100":"bg-green-100 border-green-400 text-green-800":t?"bg-red-900 border-red-700 text-red-100":"bg-red-100 border-red-400 text-red-800"} border`,children:S.message}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${t?"text-white":"text-gray-900"}`,children:"User Management"}),e.jsx("p",{className:`mt-1 text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Approve, manage, and monitor user accounts across the platform"})]}),e.jsx("button",{onClick:M,disabled:A,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 transition-colors",children:A?"Refreshing...":"Refresh"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[{title:"Total Users",value:o.all,color:"blue"},{title:"Pending Approval",value:o.pending_approval,color:"yellow"},{title:"Approved",value:o.approved,color:"green"},{title:"Rejected",value:o.rejected,color:"red"},{title:"Suspended",value:o.suspended,color:"gray"}].map((s,a)=>e.jsx("div",{className:`${t?"bg-gray-800 border-gray-700":"bg-white border-gray-100"} rounded-xl shadow-md border p-6`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wide`,children:s.title}),e.jsx("p",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"} mt-1`,children:s.value})]})},a))}),e.jsx("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Search by name, email, or business name...",value:u,onChange:s=>F(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500`})}),e.jsx("div",{children:e.jsxs("select",{value:y,onChange:s=>L(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500`,children:[e.jsxs("option",{value:"all",children:["All Status (",o.all,")"]}),e.jsxs("option",{value:"pending_approval",children:["Pending (",o.pending_approval,")"]}),e.jsxs("option",{value:"active",children:["Approved (",o.approved,")"]}),e.jsxs("option",{value:"rejected",children:["Rejected (",o.rejected,")"]}),e.jsxs("option",{value:"suspended",children:["Suspended (",o.suspended,")"]})]})}),e.jsx("div",{children:e.jsxs("select",{value:b,onChange:s=>P(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500`,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"user",children:"Regular Users"}),e.jsx("option",{value:"business",children:"Business"}),e.jsx("option",{value:"manager",children:"Managers"})]})})]})}),l.size>0&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-indigo-900/20 border-indigo-800":"bg-indigo-50 border-indigo-200"} border`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`text-sm ${t?"text-indigo-300":"text-indigo-700"} font-medium`,children:[l.size," user",l.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>C("approve"),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"Approve All"}),e.jsx("button",{onClick:()=>C("reject"),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",children:"Reject All"}),e.jsx("button",{onClick:()=>C("suspend"),className:"bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700",children:"Suspend All"}),e.jsx("button",{onClick:()=>m(new Set),className:`border px-3 py-1 rounded text-sm ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Clear"})]})]})}),e.jsxs("div",{className:`${t?"bg-gray-800 border-gray-700":"bg-white border-gray-100"} rounded-xl shadow-lg overflow-hidden border`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${t?"border-gray-700":"border-gray-100"} flex justify-between items-center`,children:[e.jsxs("h2",{className:`text-xl font-bold ${t?"text-white":"text-gray-800"}`,children:["Users (",p.length,")"]}),p.length>0&&e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.size===p.length&&p.length>0,onChange:O,className:"mr-2"}),e.jsx("span",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:"Select All"})]})]}),p.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:`${t?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-100"} border-b`,children:[e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Select"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"User"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Account Type"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Business"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Created"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wider`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${t?"divide-gray-700":"divide-gray-100"}`,children:p.map(s=>e.jsxs("tr",{className:`${t?"hover:bg-gray-700":"hover:bg-gray-50"} transition-colors`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:l.has(s.id),onChange:()=>B(s.id),className:"rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${t?"text-gray-200":"text-gray-900"}`,children:s.displayName||"No Name"}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:s.email}),s.phoneNumber&&e.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:["📞 ",s.phoneNumber]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm ${t?"text-gray-200":"text-gray-900"} capitalize`,children:s.accountType||"User"}),s.businessType&&e.jsx("span",{className:`text-xs ${t?"text-blue-400":"text-blue-600"} capitalize`,children:s.businessType})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.businessName||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:V(s)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.createdAt.toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.status==="pending_approval"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(s.id,"approve"),disabled:h.has(s.id),className:"bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700 disabled:opacity-50",children:h.has(s.id)?"Processing...":"Approve"}),e.jsx("button",{onClick:()=>f(s.id,"reject"),disabled:h.has(s.id),className:"bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700 disabled:opacity-50",children:"Reject"})]}),s.approved&&s.status==="active"&&e.jsx("button",{onClick:()=>f(s.id,"suspend"),disabled:h.has(s.id),className:"bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-700 disabled:opacity-50",children:"Suspend"}),(s.status==="suspended"||s.status==="rejected")&&e.jsx("button",{onClick:()=>f(s.id,"reactivate"),disabled:h.has(s.id),className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 disabled:opacity-50",children:"Reactivate"}),e.jsx("button",{className:`text-xs ${t?"text-indigo-400 hover:text-indigo-300":"text-indigo-600 hover:text-indigo-800"} font-medium`,children:"View Details"})]})})]},s.id))})]})}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:`text-4xl mb-4 ${t?"text-gray-600":"text-gray-400"}`,children:"👥"}),e.jsx("h3",{className:`text-lg font-medium ${t?"text-gray-300":"text-gray-900"} mb-2`,children:"No users found"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-500"}`,children:u||y!=="all"||b!=="all"?"Try adjusting your search criteria or filters.":"No users have been registered yet."})]})]})]}):e.jsx("div",{className:`container mx-auto px-4 py-8 ${t?"text-white":"text-gray-800"}`,children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🚫"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to approve users."})]})})};export{Z as default};
