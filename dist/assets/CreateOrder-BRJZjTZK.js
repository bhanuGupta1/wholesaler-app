import{h as ce,O as oe,a as me,u as ge,N as ue,r as x,c as xe,d as G,g as be,j as e,e as he,M as ye}from"./index-Cayz1xms.js";import{c as pe}from"./orderService-Ckalb_W1.js";const ve=()=>{const g=ce(),F=oe(),{user:c}=me(),{darkMode:t}=ge(),{cart:h,clearCart:M}=ue(),[O,P]=x.useState([]),[y,f]=x.useState([]),[m,T]=x.useState([]),[o,K]=x.useState({name:(c==null?void 0:c.displayName)||"",email:(c==null?void 0:c.email)||"",phone:"",address:"",city:"",zipCode:""}),[i,q]=x.useState({paymentMethod:"credit_card",cardNumber:"",expiryDate:"",cvv:"",cardHolderName:"",accountNumber:"",routingNumber:"",accountHolderName:"",bankName:"",accountType:"checking",billingAddressSame:!0,billingAddress:"",billingCity:"",billingZipCode:""}),[X,E]=x.useState(!0),[H,R]=x.useState(!1),[Q,S]=x.useState(""),[w,B]=x.useState(1),[I,ee]=x.useState(""),[v,_]=x.useState("direct"),[p,j]=x.useState("guest"),[b,L]=x.useState(null);x.useEffect(()=>{const s=y.map(r=>se(r));T(s)},[y]);const se=s=>{if(!s.bulkPricing||typeof s.bulkPricing!="object")return{...s,effectivePrice:s.price,hasBulkDiscount:!1};const n=Object.keys(s.bulkPricing).map(l=>parseInt(l)).filter(l=>!isNaN(l)).sort((l,a)=>a-l).find(l=>s.quantity>=l);if(n){const l=s.bulkPricing[n.toString()],a=s.price-l,d=a/s.price*100;return{...s,effectivePrice:l,hasBulkDiscount:!0,bulkPricing:{...s.bulkPricing,isBulkPrice:!0,originalPrice:s.price,bulkDiscount:d,bulkTier:n,appliedPrice:l,savings:a}}}return{...s,effectivePrice:s.price,hasBulkDiscount:!1,bulkPricing:{...s.bulkPricing,isBulkPrice:!1}}};x.useEffect(()=>{var s;if((s=F.state)!=null&&s.fromCart&&h.length>0){_("cart");const r=h.map(n=>({...n,quantity:n.quantity}));f(r),B(2)}},[F.state,h]),x.useEffect(()=>{(async()=>{var r,n,l,a;if(!(c!=null&&c.uid)){j("guest"),L(null);return}try{const d=he(G,"users",c.uid),$=await ye(d);if($.exists()){const N=$.data(),C=N.accountType,A=N.businessType;j(C==="admin"||C==="manager"?"admin":C==="business"?"business":"customer"),L({accountType:C,businessType:A})}else(r=c.email)!=null&&r.includes("admin")?j("admin"):(n=c.email)!=null&&n.includes("business")?j("business"):j("customer"),L(null)}catch(d){console.error("Error fetching user role:",d),(l=c.email)!=null&&l.includes("admin")?j("admin"):(a=c.email)!=null&&a.includes("business")?j("business"):j("customer"),L(null)}})()},[c]),x.useEffect(()=>{te()},[]);const te=async()=>{try{E(!0);const s=xe(G,"products"),n=(await be(s)).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.stock>0);P(n),E(!1)}catch(s){console.error("Error fetching products:",s),S("Failed to load products"),E(!1)}},U=O.filter(s=>{var r;return s.name.toLowerCase().includes(I.toLowerCase())||((r=s.category)==null?void 0:r.toLowerCase().includes(I.toLowerCase()))}),re=(s,r)=>{const n=y.findIndex(l=>l.id===s.id);if(n>-1){const l=[...y];l[n].quantity=Math.min(l[n].quantity+r,s.stock),f(l)}else f([...y,{...s,quantity:Math.min(r,s.stock)}])},V=s=>{f(y.filter(r=>r.id!==s))},W=(s,r)=>{if(r<=0){V(s);return}const n=O.find(a=>a.id===s)||y.find(a=>a.id===s),l=y.map(a=>a.id===s?{...a,quantity:Math.min(r,n.stock)}:a);f(l)},J=()=>{let s=0,r=0,n=0,l=0,a=0,d=0;m.forEach(N=>{const C=N.effectivePrice||N.price,A=N.price;s+=C*N.quantity,r+=A*N.quantity,N.hasBulkDiscount&&(n+=(A-C)*N.quantity)}),p==="business"&&(l=s*.15,(m.reduce((C,A)=>C+A.quantity,0)>=10||s>=500)&&(a=s*.05)),p==="customer"&&(d=(s-l-a)*.15);const $=s-l-a+d;return{subtotal:s,originalSubtotal:r,itemLevelBulkSavings:n,businessDiscount:l,additionalBulkDiscount:a,totalBulkSavings:n,totalBusinessSavings:l+a,totalSavings:n+l+a,tax:d,total:$}},ae=()=>{if(p!=="business")return null;const s=m.reduce((a,d)=>a+d.quantity,0),r=m.reduce((a,d)=>a+(d.effectivePrice||d.price)*d.quantity,0);if(s>=10||r>=500)return{qualified:!0,message:"✓ Additional 5% Bulk Qualified"};const n=Math.max(0,10-s),l=Math.max(0,500-r);return n>0&&l>0?{qualified:!1,message:`Need ${n} more items OR $${l.toFixed(0)} more for extra 5% bulk discount`}:n>0?{qualified:!1,message:`Need ${n} more items for extra 5% bulk discount`}:{qualified:!1,message:`Need $${l.toFixed(0)} more for extra 5% bulk discount`}},D=s=>{const{name:r,value:n}=s.target;K(l=>({...l,[r]:n}))},k=s=>{const{name:r,value:n,type:l,checked:a}=s.target;q(d=>({...d,[r]:l==="checkbox"?a:n}))},ie=s=>{const r=s.replace(/\s+/g,"").replace(/[^0-9]/gi,""),n=r.match(/\d{4,16}/g),l=n&&n[0]||"",a=[];for(let d=0,$=l.length;d<$;d+=4)a.push(l.substring(d,d+4));return a.length?a.join(" "):r},ne=s=>{const r=s.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return r.length>=2?r.substring(0,2)+(r.length>2?"/"+r.substring(2,4):""):r},z=()=>["name","email","phone","address","city"].every(r=>o[r].trim()!==""),Z=()=>i.paymentMethod==="credit_card"?i.cardNumber.replace(/\s/g,"").length>=13&&i.expiryDate.length===5&&i.cvv.length>=3&&i.cardHolderName.trim()!=="":i.accountNumber.trim()!==""&&i.routingNumber.trim()!==""&&i.accountHolderName.trim()!==""&&i.bankName.trim()!=="",Y=()=>{if(h.length>0){const s=h.map(r=>({...r,quantity:r.quantity}));f(s),_("cart"),B(2)}},le=()=>{f([]),_("direct"),B(1)},de=async()=>{if(!c){S("Please sign in to place an order");return}if(y.length===0){S("Please select at least one product");return}if(!z()){S("Please fill in all required customer information");return}if(!Z()){S("Please fill in all required payment information");return}try{R(!0),S("");const s=J(),r=i.billingAddressSame?{address:o.address,city:o.city,zipCode:o.zipCode}:{address:i.billingAddress,city:i.billingCity,zipCode:i.billingZipCode},n={customerName:o.name,customerEmail:o.email,customerPhone:o.phone,shippingAddress:{address:o.address,city:o.city,zipCode:o.zipCode},billingAddress:r,paymentInfo:{paymentMethod:i.paymentMethod,...i.paymentMethod==="credit_card"?{cardLastFour:i.cardNumber.slice(-4),cardHolderName:i.cardHolderName,expiryDate:i.expiryDate}:{accountLastFour:i.accountNumber.slice(-4),accountHolderName:i.accountHolderName,bankName:i.bankName,accountType:i.accountType}},userId:c.uid,userRole:p,userAccountType:b==null?void 0:b.accountType,userBusinessType:b==null?void 0:b.businessType,orderSource:v,items:m.map(a=>{var d,$;return{productId:a.id,productName:a.name,originalPrice:a.price,effectivePrice:a.effectivePrice||a.price,quantity:a.quantity,subtotal:(a.effectivePrice||a.price)*a.quantity,hasItemBulkPricing:!!a.hasBulkDiscount,itemBulkTier:((d=a.bulkPricing)==null?void 0:d.bulkTier)||null,itemBulkDiscount:(($=a.bulkPricing)==null?void 0:$.bulkDiscount)||0,itemBulkSavings:a.hasBulkDiscount?(a.price-a.effectivePrice)*a.quantity:0,wasAutoApplied:!!a.hasBulkDiscount}}),itemCount:m.reduce((a,d)=>a+d.quantity,0),originalSubtotal:s.originalSubtotal,subtotal:s.subtotal,itemLevelBulkSavings:s.itemLevelBulkSavings,businessDiscount:s.businessDiscount,additionalBulkDiscount:s.additionalBulkDiscount,totalBusinessSavings:s.totalBusinessSavings,totalBulkSavings:s.totalBulkSavings,totalSavings:s.totalSavings,tax:s.tax,total:s.total,hasItemLevelBulkDiscounts:s.itemLevelBulkSavings>0,hasBusinessDiscounts:s.totalBusinessSavings>0,qualifiesForAdditionalBulkDiscount:s.additionalBulkDiscount>0,status:"pending",paymentStatus:"pending"},l=await pe(n);v==="cart"&&M(),await new Promise(a=>setTimeout(a,2e3)),R(!1),g(`/orders/${l}`,{state:{message:"Order placed successfully!"}})}catch(s){console.error("Error creating order:",s),S(s.message||"Failed to create order. Please try again."),R(!1)}};if(X)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})});const u=J();return e.jsx("div",{className:`min-h-screen ${t?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"}`,children:"Create New Order"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[h.length>0&&v==="direct"&&e.jsxs("button",{onClick:Y,className:`px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-600 hover:text-white transition-colors ${t?"border-indigo-400 text-indigo-400 hover:bg-indigo-400 hover:text-gray-900":""}`,children:["Import from Cart (",h.length," items)"]}),v==="cart"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:"🛒 From Cart"}),e.jsx("button",{onClick:le,className:`px-3 py-1 text-sm border rounded ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Start Fresh"})]})]})]}),e.jsx("div",{className:"flex items-center mt-2",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${p==="business"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":p==="customer"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":p==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:[p==="business"&&e.jsxs(e.Fragment,{children:[(b==null?void 0:b.businessType)==="seller"?"🏪":(b==null?void 0:b.businessType)==="buyer"?"🛒":"🏢","Business Account ",b!=null&&b.businessType?`(${b.businessType.charAt(0).toUpperCase()+b.businessType.slice(1)})`:""," - 15% Business + Auto Bulk + 5% Extra Available",(()=>{const s=ae();return s?e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded-full ${s.qualified?"bg-green-500 text-white":"bg-yellow-500 text-white"}`,children:s.message}):null})()]}),p==="customer"&&"👤 Customer Account - 15% Tax Applied + Auto Bulk Pricing",p==="admin"&&"⚙️ Admin Account - No Additional Charges",p==="guest"&&"👤 Guest User"]})}),u.itemLevelBulkSavings>0&&e.jsx("div",{className:`mt-4 p-4 rounded-lg ${t?"bg-green-900/20 border-green-800":"bg-green-50 border-green-200"} border`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-2xl mr-3",children:"🎉"}),e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold ${t?"text-green-300":"text-green-800"}`,children:["Auto Bulk Pricing Applied! Saving $",u.itemLevelBulkSavings.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${t?"text-green-200":"text-green-700"}`,children:[m.filter(s=>s.hasBulkDiscount).length," items automatically qualified for volume discounts"]})]})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-center",children:[{num:1,label:"Select Products",icon:"🛍️"},{num:2,label:"Customer & Payment Info",icon:"📋"},{num:3,label:"Review & Pay",icon:"💳"}].map((s,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center px-4 py-2 rounded-lg ${w>=s.num?"bg-indigo-600 text-white":t?"bg-gray-700 text-gray-400":"bg-gray-200 text-gray-600"}`,children:[e.jsx("span",{className:"mr-2",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label}),s.num===1&&v==="cart"&&e.jsx("span",{className:"ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full",children:"From Cart"})]}),r<2&&e.jsx("div",{className:`w-8 h-0.5 mx-2 ${w>s.num?"bg-indigo-600":t?"bg-gray-700":"bg-gray-300"}`})]},s.num))})}),Q&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border-l-4 ${t?"bg-red-900/30 border-red-800 text-red-400":"bg-red-50 border-red-400 text-red-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚠️"}),e.jsx("p",{className:"text-sm",children:Q})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[w===1&&e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[h.length>0&&v==="direct"&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${t?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${t?"text-blue-400":"text-blue-700"}`,children:"Items in Cart"}),e.jsxs("p",{className:`text-sm ${t?"text-blue-300":"text-blue-600"}`,children:["You have ",h.length," item(s) in your cart. Import them to create an order quickly."]})]}),e.jsx("button",{onClick:Y,className:"px-4 py-2 rounded-lg font-medium bg-blue-600 hover:bg-blue-700 text-white",children:"Import Cart"})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search products...",value:I,onChange:s=>ee(s.target.value),className:`block w-full pl-10 pr-3 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300"}`})]})}),e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Available Products (",U.length,")"]}),U.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📦"}),e.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-500"}`,children:I?"No products found matching your search.":"No products available for order."})]}):e.jsx("div",{className:"space-y-3",children:U.map(s=>e.jsx(fe,{product:s,onAddToOrder:re,darkMode:t,isSelected:y.find(r=>r.id===s.id)},s.id))})]}),w===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"📋"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Phone *"}),e.jsx("input",{type:"tel",name:"phone",value:o.phone,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"City *"}),e.jsx("input",{type:"text",name:"city",value:o.city,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Address *"}),e.jsx("input",{type:"text",name:"address",value:o.address,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Zip Code"}),e.jsx("input",{type:"text",name:"zipCode",value:o.zipCode,onChange:D,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]})]})]}),e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"💳"}),"Payment Information"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-3`,children:"Payment Method *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${i.paymentMethod==="credit_card"?t?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":t?"border-gray-600":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"credit_card",checked:i.paymentMethod==="credit_card",onChange:k,className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"💳 Credit Card"}),e.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Visa, MasterCard, etc."})]})]}),e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${i.paymentMethod==="bank_account"?t?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":t?"border-gray-600":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank_account",checked:i.paymentMethod==="bank_account",onChange:k,className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"🏦 Bank Account"}),e.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Direct bank transfer"})]})]})]})]}),i.paymentMethod==="credit_card"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Card Holder Name *"}),e.jsx("input",{type:"text",name:"cardHolderName",value:i.cardHolderName,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Card Number *"}),e.jsx("input",{type:"text",name:"cardNumber",value:i.cardNumber,onChange:s=>{const r=ie(s.target.value);q(n=>({...n,cardNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"1234 5678 9012 3456",maxLength:"19",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Expiry Date *"}),e.jsx("input",{type:"text",name:"expiryDate",value:i.expiryDate,onChange:s=>{const r=ne(s.target.value);q(n=>({...n,expiryDate:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"MM/YY",maxLength:"5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"CVV *"}),e.jsx("input",{type:"text",name:"cvv",value:i.cvv,onChange:s=>{const r=s.target.value.replace(/\D/g,"");q(n=>({...n,cvv:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"123",maxLength:"4",required:!0})]})]}),i.paymentMethod==="bank_account"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Holder Name *"}),e.jsx("input",{type:"text",name:"accountHolderName",value:i.accountHolderName,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Bank Name *"}),e.jsx("input",{type:"text",name:"bankName",value:i.bankName,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"Chase Bank",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Type *"}),e.jsxs("select",{name:"accountType",value:i.accountType,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"checking",children:"Checking"}),e.jsx("option",{value:"savings",children:"Savings"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Number *"}),e.jsx("input",{type:"text",name:"accountNumber",value:i.accountNumber,onChange:s=>{const r=s.target.value.replace(/\D/g,"");q(n=>({...n,accountNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"123456789",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Routing Number *"}),e.jsx("input",{type:"text",name:"routingNumber",value:i.routingNumber,onChange:s=>{const r=s.target.value.replace(/\D/g,"");q(n=>({...n,routingNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"021000021",maxLength:"9",required:!0})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",name:"billingAddressSame",checked:i.billingAddressSame,onChange:k,className:"mr-3"}),e.jsx("label",{className:`text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Billing address is the same as shipping address"})]}),!i.billingAddressSame&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Billing Address *"}),e.jsx("input",{type:"text",name:"billingAddress",value:i.billingAddress,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!i.billingAddressSame})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"City *"}),e.jsx("input",{type:"text",name:"billingCity",value:i.billingCity,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!i.billingAddressSame})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Zip Code *"}),e.jsx("input",{type:"text",name:"billingZipCode",value:i.billingZipCode,onChange:k,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!i.billingAddressSame})]})]})]})]})]}),w===3&&e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"✅"}),"Review & Confirm Order"]}),v==="cart"&&e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:"🛒 Order created from cart items"})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Order Items"}),e.jsx("div",{className:"space-y-3",children:m.map(s=>{const r=s.effectivePrice||s.price,n=s.hasBulkDiscount?(s.price-r)*s.quantity:0;return e.jsxs("div",{className:`flex justify-between items-center p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-12 h-12 ${t?"bg-gray-600":"bg-gray-200"} rounded-lg flex items-center justify-center`,children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-12 h-12 object-cover rounded-lg"}):e.jsx("span",{children:"📦"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["$",r.toFixed(2)," × ",s.quantity,s.hasBulkDiscount&&e.jsxs("span",{className:"ml-2 text-green-600 font-medium",children:["(was $",s.price.toFixed(2),")"]})]}),s.hasBulkDiscount&&e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["🎯 Auto bulk: ",s.bulkPricing.bulkDiscount.toFixed(0),"% off • ",s.bulkPricing.bulkTier,"+ units"]})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-lg",children:["$",(r*s.quantity).toFixed(2)]}),n>0&&e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["Saved $",n.toFixed(2)]})]})]},s.id)})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Shipping Information"}),e.jsx("div",{className:`p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o.name}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:o.email}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:o.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:o.address}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:[o.city," ",o.zipCode]})]})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Payment Information"}),e.jsx("div",{className:`p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:i.paymentMethod==="credit_card"?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"💳 Credit Card"}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:["•••• •••• •••• ",i.cardNumber.slice(-4)]}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:i.cardHolderName})]}):e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"🏦 Bank Account"}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:[i.bankName," - •••••",i.accountNumber.slice(-4)]}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:i.accountHolderName})]})})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6 sticky top-4`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"🛒"}),"Order Summary",v==="cart"&&e.jsx("span",{className:"ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full",children:"Cart"})]}),m.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🛍️"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"No products selected"}),h.length>0&&v==="direct"&&e.jsxs("button",{onClick:Y,className:"mt-3 text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:["Import ",h.length," items from cart"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:m.map(s=>e.jsxs("div",{className:`p-3 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-sm font-medium truncate pr-2",children:s.name}),e.jsx("button",{onClick:()=>V(s.id),className:"text-red-500 hover:text-red-700 ml-2",children:"×"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>W(s.id,s.quantity-1),className:`w-6 h-6 rounded-full ${t?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"} flex items-center justify-center text-sm`,children:"−"}),e.jsx("span",{className:"text-sm font-medium",children:s.quantity}),e.jsx("button",{onClick:()=>W(s.id,s.quantity+1),className:`w-6 h-6 rounded-full ${t?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"} flex items-center justify-center text-sm`,children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold",children:["$",((s.effectivePrice||s.price)*s.quantity).toFixed(2)]}),s.hasBulkDiscount&&e.jsx("p",{className:"text-xs text-green-600",children:"Auto bulk applied"})]})]})]},s.id))}),e.jsx("div",{className:`pt-4 border-t ${t?"border-gray-600":"border-gray-200"}`,children:e.jsxs("div",{className:"space-y-2",children:[u.totalSavings>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:`${t?"text-gray-400":"text-gray-500"} line-through`,children:"Original Subtotal:"}),e.jsxs("span",{className:`${t?"text-gray-400":"text-gray-500"} line-through`,children:["$",u.originalSubtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",u.subtotal.toFixed(2)]})]}),u.itemLevelBulkSavings>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"🎯 Auto Bulk Discounts:"}),e.jsxs("span",{children:["-$",u.itemLevelBulkSavings.toFixed(2)]})]}),u.businessDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Business Discount (15%):"}),e.jsxs("span",{children:["-$",u.businessDiscount.toFixed(2)]})]}),p==="business"&&u.additionalBulkDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"🎯 Extra Bulk Discount (5%):"}),e.jsxs("span",{children:["-$",u.additionalBulkDiscount.toFixed(2)]})]}),u.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax (15%):"}),e.jsxs("span",{children:["$",u.tax.toFixed(2)]})]}),e.jsxs("div",{className:`flex justify-between font-bold text-lg pt-2 border-t ${t?"border-gray-600":"border-gray-200"}`,children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",u.total.toFixed(2)]})]}),u.totalSavings>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400 font-medium pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsx("span",{children:"💰 Total Savings:"}),e.jsxs("span",{children:["$",u.totalSavings.toFixed(2)]})]})]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[w===1&&e.jsxs("button",{onClick:()=>B(2),disabled:m.length===0,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${m.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:["Continue to Customer Info",e.jsx("span",{className:"ml-2",children:"→"})]}),w===2&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>B(3),disabled:!z()||!Z(),className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${!z()||!Z()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:["Review Order",e.jsx("span",{className:"ml-2",children:"→"})]}),e.jsx("button",{onClick:()=>B(1),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Products"})]}),w===3&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:de,disabled:H,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${H?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white`,children:H?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Place Order • $",u.total.toFixed(2),e.jsx("span",{className:"ml-2",children:"✓"})]})}),e.jsx("button",{onClick:()=>B(2),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Customer Info"})]}),v==="cart"&&w===1&&e.jsx("button",{onClick:()=>g("/cart"),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Cart"})]}),e.jsx("div",{className:`mt-4 p-3 rounded-lg ${t?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-200"} border text-xs`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2",children:"🔒"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${t?"text-blue-400":"text-blue-700"}`,children:"Secure Payment"}),e.jsx("p",{className:`${t?"text-blue-300":"text-blue-600"} mt-1`,children:"Your payment information is encrypted and secure."}),u.totalSavings>0&&e.jsx("p",{className:`${t?"text-green-300":"text-green-600"} mt-1 font-medium`,children:"Auto discounts applied & locked in!"})]})]})})]})})]})]})})},fe=({product:g,onAddToOrder:F,darkMode:c,isSelected:t})=>{const[h,M]=x.useState(1),P=(()=>{if(!g.bulkPricing||typeof g.bulkPricing!="object")return null;const f=Object.keys(g.bulkPricing).map(m=>parseInt(m)).filter(m=>!isNaN(m)).sort((m,T)=>m-T).find(m=>h>=m);if(f){const m=g.bulkPricing[f.toString()],o=(g.price-m)/g.price*100;return{bulkPrice:m,discountPercent:o,tier:f}}return null})();return e.jsx("div",{className:`border rounded-lg p-4 transition-all hover:shadow-md ${t?c?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":c?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 ${c?"bg-gray-600":"bg-gray-100"} rounded-lg flex items-center justify-center flex-shrink-0`,children:g.imageUrl?e.jsx("img",{src:g.imageUrl,alt:g.name,className:"w-12 h-12 object-cover rounded-lg"}):e.jsx("span",{className:"text-xl",children:"📦"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:g.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[P?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["$",P.bulkPrice.toFixed(2)]}),e.jsxs("span",{className:`line-through ${c?"text-gray-500":"text-gray-400"}`,children:["$",g.price.toFixed(2)]}),e.jsxs("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full font-semibold",children:[P.discountPercent.toFixed(0),"% OFF"]})]}):e.jsxs("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:["$",g.price.toFixed(2)]}),e.jsxs("span",{className:`${c?"text-gray-400":"text-gray-500"}`,children:["Stock: ",g.stock]})]}),P&&e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["🎯 Auto bulk pricing - ",P.tier,"+ units"]}),g.category&&e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${c?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:g.category})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:`text-xs ${c?"text-gray-400":"text-gray-500"}`,children:"Qty:"}),e.jsx("input",{type:"number",min:"1",max:g.stock,value:h,onChange:y=>M(Math.max(1,Math.min(g.stock,parseInt(y.target.value)||1))),className:`w-16 px-2 py-1 border rounded text-sm text-center ${c?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),e.jsx("button",{onClick:()=>F(g,h),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors",children:t?"Add More":"Add"})]})]})})};export{ve as default};
