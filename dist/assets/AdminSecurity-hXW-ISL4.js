import{u as D,a as L,r as m,j as e,L as P,g as N,c as w,d as v,b as S,e as E,q as T,k as C,l as R}from"./index-C076F-ZT.js";const A=({darkMode:t})=>{const[o,u]=m.useState([]),[d,h]=m.useState({totalEvents:0,highPriority:0,mediumPriority:0,lowPriority:0}),[p,y]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const s=await N(w(v,"users")),i=[];s.docs.forEach(a=>{var f,j;const x=a.data(),b=((f=x.createdAt)==null?void 0:f.toDate())||new Date;(x.status==="suspended"||x.status==="rejected")&&i.push({id:a.id+"_status",type:"ACCOUNT_ACTION",severity:x.status==="suspended"?"HIGH":"MEDIUM",description:`User account ${x.status}: ${x.email}`,timestamp:((j=x.updatedAt)==null?void 0:j.toDate())||b,userEmail:x.email,status:"resolved"});const $=new Date(Date.now()-24*60*60*1e3);b>$&&i.push({id:a.id+"_registration",type:"NEW_REGISTRATION",severity:"LOW",description:`New user registration: ${x.email}`,timestamp:b,userEmail:x.email,status:x.approved?"approved":"pending"})}),i.sort((a,x)=>x.timestamp-a.timestamp),u(i.slice(0,20));const l=i.filter(a=>a.severity==="HIGH").length,g=i.filter(a=>a.severity==="MEDIUM").length,n=i.filter(a=>a.severity==="LOW").length;h({totalEvents:i.length,highPriority:l,mediumPriority:g,lowPriority:n})}catch(s){console.error("Error fetching security events:",s)}finally{y(!1)}})()},[]);const c=r=>{switch(r){case"HIGH":return"red";case"MEDIUM":return"yellow";case"LOW":return"green";default:return"gray"}};return p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:`text-center ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ›¡ï¸"}),e.jsx("div",{children:"Loading security data..."})]})}):e.jsxs("div",{className:`p-6 rounded-lg border ${t?"bg-gray-800/50 border-red-500/30":"bg-white border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:`text-lg font-semibold ${t?"text-red-400":"text-red-600"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸ›¡ï¸"}),"Security Monitor"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${d.highPriority>0?"bg-red-500 text-white":d.mediumPriority>0?"bg-yellow-500 text-black":"bg-green-500 text-white"}`,children:d.highPriority>0?"HIGH ALERT":d.mediumPriority>0?"MEDIUM":"SECURE"})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[{label:"Total Events",value:d.totalEvents,color:"blue"},{label:"High Priority",value:d.highPriority,color:"red"},{label:"Medium Priority",value:d.mediumPriority,color:"yellow"},{label:"Low Priority",value:d.lowPriority,color:"green"}].map((r,s)=>e.jsxs("div",{className:`p-3 rounded border text-center ${t?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[e.jsx("div",{className:`text-xl font-bold text-${r.color}-500`,children:r.value}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:r.label})]},s))}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:o.length>0?o.map(r=>e.jsx("div",{className:`p-3 rounded border flex items-center justify-between ${t?"bg-gray-700/30 border-gray-600":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded bg-${c(r.severity)}-500 text-white`,children:r.type}),e.jsx("span",{className:`text-xs ${r.status==="resolved"?"text-green-500":r.status==="pending"?"text-yellow-500":"text-blue-500"}`,children:r.status.toUpperCase()})]}),e.jsx("div",{className:`text-sm ${t?"text-gray-200":"text-gray-800"}`,children:r.description}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:r.timestamp.toLocaleString()})]})},r.id)):e.jsxs("div",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"âœ…"}),e.jsx("div",{children:"No security events detected"})]})})]})},H=({darkMode:t})=>{const[o,u]=m.useState([]),[d,h]=m.useState([]),[p,y]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const l=(await N(w(v,"users"))).docs.map(a=>{var x,b;return{id:a.id,...a.data(),lastActivity:((x=a.data().updatedAt)==null?void 0:x.toDate())||((b=a.data().createdAt)==null?void 0:b.toDate())||new Date}}),g=l.filter(a=>a.status==="active"&&a.approved).slice(0,10),n=l.filter(a=>a.status==="suspended"||a.status==="rejected");u(g),h(n)}catch(i){console.error("Error fetching user data:",i)}finally{y(!1)}})()},[]);const c=async s=>{try{await S(E(v,"users",s),{status:"suspended",isActive:!1,updatedAt:new Date});const i=o.find(l=>l.id===s);i&&(u(l=>l.filter(g=>g.id!==s)),h(l=>[...l,{...i,status:"suspended"}]))}catch(i){console.error("Error suspending user:",i)}},r=async s=>{try{await S(E(v,"users",s),{status:"active",isActive:!0,approved:!0,updatedAt:new Date});const i=d.find(l=>l.id===s);i&&(h(l=>l.filter(g=>g.id!==s)),u(l=>[...l,{...i,status:"active"}]))}catch(i){console.error("Error reactivating user:",i)}};return p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:`text-center ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‘¥"}),e.jsx("div",{children:"Loading access control data..."})]})}):e.jsxs("div",{className:`p-6 rounded-lg border ${t?"bg-gray-800/50 border-blue-500/30":"bg-white border-blue-200"}`,children:[e.jsxs("h3",{className:`text-lg font-semibold mb-6 ${t?"text-blue-400":"text-blue-600"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸ‘¥"}),"Access Control"]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h4",{className:`text-sm font-medium mb-4 ${t?"text-gray-300":"text-gray-700"}`,children:["Recent Active Users (",o.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[o.map(s=>{var i;return e.jsx("div",{className:`p-4 rounded border ${t?"bg-gray-700/30 border-gray-600":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:s.displayName||s.firstName+" "+s.lastName||"No Name"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.accountType==="admin"?"bg-red-100 text-red-800":s.accountType==="manager"?"bg-purple-100 text-purple-800":s.accountType==="business"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:((i=s.accountType)==null?void 0:i.toUpperCase())||"USER"})]}),e.jsxs("div",{className:`text-xs space-y-1 ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsxs("div",{children:["Email: ",s.email]}),e.jsxs("div",{children:["Last Activity: ",s.lastActivity.toLocaleString()]}),s.businessName&&e.jsxs("div",{children:["Business: ",s.businessName]})]})]}),e.jsx("button",{onClick:()=>c(s.id),className:"px-3 py-2 rounded text-xs font-medium bg-red-600 hover:bg-red-500 text-white transition-all",children:"Suspend"})]})},s.id)}),o.length===0&&e.jsx("div",{className:`text-center py-4 ${t?"text-gray-400":"text-gray-600"}`,children:"No active users found"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:`text-sm font-medium mb-4 ${t?"text-gray-300":"text-gray-700"}`,children:["Suspended/Blocked Users (",d.length,")"]}),e.jsxs("div",{className:"space-y-2",children:[d.map(s=>e.jsxs("div",{className:`p-3 rounded border flex items-center justify-between ${t?"bg-gray-700/30 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${t?"text-gray-200":"text-gray-800"}`,children:s.displayName||s.email}),e.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Status: ",s.status," â€¢ Email: ",s.email]})]}),e.jsx("button",{onClick:()=>r(s.id),className:"px-3 py-1 rounded text-xs font-medium bg-green-600 hover:bg-green-500 text-white transition-all",children:"Reactivate"})]},s.id)),d.length===0&&e.jsx("div",{className:`text-center py-4 ${t?"text-gray-400":"text-gray-600"}`,children:"No suspended users"})]})]})]})},O=({darkMode:t})=>{const[o,u]=m.useState([]),[d,h]=m.useState("all"),[p,y]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const i=await N(T(w(v,"users"),C("updatedAt","desc"),R(50))),l=[];i.docs.forEach(g=>{var b,$;const n=g.data(),a=((b=n.createdAt)==null?void 0:b.toDate())||new Date,x=(($=n.updatedAt)==null?void 0:$.toDate())||a;if(l.push({id:g.id+"_created",type:"USER_REGISTRATION",severity:"info",description:`New user registered: ${n.email}`,timestamp:a,user:n.email,details:`Account type: ${n.accountType||"user"}`}),n.updatedAt&&n.status){let f="USER_UPDATE",j="info";n.status==="suspended"?(f="USER_SUSPENDED",j="warning"):n.status==="rejected"?(f="USER_REJECTED",j="warning"):n.status==="active"&&n.approved&&(f="USER_APPROVED",j="info"),l.push({id:g.id+"_updated",type:f,severity:j,description:`User ${n.status}: ${n.email}`,timestamp:x,user:n.email,details:`Status changed to: ${n.status}`})}}),l.sort((g,n)=>n.timestamp-g.timestamp),u(l.slice(0,30))}catch(i){console.error("Error fetching audit logs:",i)}finally{y(!1)}})()},[]);const c=d==="all"?o:o.filter(s=>s.severity===d),r=s=>{switch(s){case"warning":return"yellow";case"info":return"blue";default:return"gray"}};return p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:`text-center ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ“"}),e.jsx("div",{children:"Loading audit logs..."})]})}):e.jsxs("div",{className:`p-6 rounded-lg border ${t?"bg-gray-800/50 border-purple-500/30":"bg-white border-purple-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:`text-lg font-semibold ${t?"text-purple-400":"text-purple-600"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸ“"}),"Security Audit Log"]}),e.jsxs("select",{value:d,onChange:s=>h(s.target.value),className:`p-2 rounded border text-sm ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Events"}),e.jsx("option",{value:"warning",children:"Warnings"}),e.jsx("option",{value:"info",children:"Info"})]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.length>0?c.map(s=>e.jsx("div",{className:`p-3 rounded border ${t?"bg-gray-700/30 border-gray-600":"bg-gray-50 border-gray-200"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded bg-${r(s.severity)}-500 text-white`,children:s.type}),e.jsx("span",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:s.timestamp.toLocaleString()})]}),e.jsx("div",{className:`text-sm mb-1 ${t?"text-gray-200":"text-gray-800"}`,children:s.description}),e.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:["User: ",s.user," â€¢ ",s.details]})]})})},s.id)):e.jsxs("div",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ“"}),e.jsx("div",{children:"No audit logs found"})]})})]})},U=({darkMode:t})=>{const[o,u]=m.useState({totalUsers:0,activeUsers:0,totalProducts:0,totalOrders:0,pendingApprovals:0,systemUptime:99.9}),[d,h]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const[r,s,i]=await Promise.all([N(w(v,"users")),N(w(v,"products")),N(w(v,"orders"))]),l=r.docs.map(a=>a.data()),g=l.filter(a=>a.status==="active"&&a.approved),n=l.filter(a=>a.status==="pending_approval"||a.status==="pending");u({totalUsers:r.size,activeUsers:g.length,totalProducts:s.size,totalOrders:i.size,pendingApprovals:n.length,systemUptime:99.9})}catch(r){console.error("Error fetching health metrics:",r)}finally{h(!1)}})()},[]);const p=(c,r)=>r==="uptime"?c>99.5?"green":c>98?"yellow":"red":r==="pending"?c===0?"green":c<5?"yellow":"red":c>0?"green":"gray";if(d)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:`text-center ${t?"text-gray-400":"text-gray-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ’š"}),e.jsx("div",{children:"Loading system health..."})]})});const y=[{label:"Total Users",value:o.totalUsers,type:"normal"},{label:"Active Users",value:o.activeUsers,type:"normal"},{label:"Total Products",value:o.totalProducts,type:"normal"},{label:"Total Orders",value:o.totalOrders,type:"normal"},{label:"Pending Approvals",value:o.pendingApprovals,type:"pending"},{label:"System Uptime",value:`${o.systemUptime}%`,type:"uptime"}];return e.jsxs("div",{className:`p-6 rounded-lg border ${t?"bg-gray-800/50 border-green-500/30":"bg-white border-green-200"}`,children:[e.jsxs("h3",{className:`text-lg font-semibold mb-6 ${t?"text-green-400":"text-green-600"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸ’š"}),"System Health"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:y.map((c,r)=>{const s=p(typeof c.value=="string"?parseFloat(c.value):c.value,c.type);return e.jsx("div",{className:`p-4 rounded border ${t?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold text-${s}-500 mb-1`,children:c.value}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:c.label})]})},r)})}),e.jsx("div",{className:"mt-6 p-4 rounded border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Overall Status:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:`text-sm font-medium ${t?"text-green-400":"text-green-600"}`,children:"System Operational"})]})]})})]})},I=()=>{const{darkMode:t}=D(),{user:o}=L(),[u,d]=m.useState("monitor"),[h,p]=m.useState(null),y=(r,s="success")=>{p({message:r,type:s}),setTimeout(()=>p(null),4e3)},c=[{id:"monitor",label:"Security Monitor",icon:"ðŸ›¡ï¸"},{id:"access",label:"Access Control",icon:"ðŸ‘¥"},{id:"audit",label:"Audit Log",icon:"ðŸ“"},{id:"health",label:"System Health",icon:"ðŸ’š"}];return e.jsxs("div",{className:`min-h-screen ${t?"bg-gray-900":"bg-gray-50"} p-6`,children:[h&&e.jsx("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${h.type==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:h.message}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`text-3xl font-bold ${t?"text-white":"text-gray-900"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸ”’"}),"Security Center"]}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Monitor system security and manage user access controls"})]}),e.jsx(P,{to:"/admin",className:`px-4 py-2 rounded-lg text-sm transition-all border ${t?"bg-gray-800 hover:bg-gray-700 text-blue-400 border-blue-500/50":"bg-white hover:bg-gray-50 text-blue-600 border-blue-500/50"}`,children:"â† Back to Admin"})]}),e.jsx("div",{className:"flex space-x-1 bg-opacity-20 rounded-lg p-1",children:c.map(r=>e.jsxs("button",{onClick:()=>d(r.id),className:`flex-1 py-3 px-4 rounded text-sm font-medium transition-all ${u===r.id?"bg-red-600 text-white":t?"text-gray-300 hover:text-white hover:bg-gray-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"mr-2",children:r.icon}),r.label]},r.id))})]}),e.jsxs("div",{className:"space-y-6",children:[u==="monitor"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(A,{darkMode:t}),e.jsx(U,{darkMode:t})]}),u==="access"&&e.jsx(H,{darkMode:t}),u==="audit"&&e.jsx(O,{darkMode:t}),u==="health"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(U,{darkMode:t}),e.jsx(A,{darkMode:t})]})]}),e.jsxs("div",{className:`mt-8 p-6 rounded-lg border ${t?"bg-red-900/20 border-red-500/30":"bg-red-50 border-red-200"}`,children:[e.jsxs("h3",{className:`text-lg font-semibold mb-4 ${t?"text-red-400":"text-red-600"} flex items-center`,children:[e.jsx("span",{className:"mr-3",children:"ðŸš¨"}),"Emergency Actions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{label:"Suspend All Business Users",description:"Temporarily suspend all business accounts",color:"red",action:()=>y("This would suspend all business users","warning")},{label:"Export Security Logs",description:"Download all security audit logs",color:"blue",action:()=>y("Security logs would be exported","success")},{label:"Reset Failed Logins",description:"Clear all failed login counters",color:"green",action:()=>y("Failed login counters would be reset","success")}].map((r,s)=>e.jsxs("button",{onClick:r.action,className:`p-4 rounded border text-left transition-all hover:scale-105 ${t?`bg-gray-800 border-${r.color}-500/50 hover:bg-${r.color}-900/20`:`bg-white border-${r.color}-200 hover:bg-${r.color}-50`}`,children:[e.jsx("div",{className:`text-sm font-medium mb-2 text-${r.color}-500`,children:r.label}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:r.description})]},s))})]})]})};export{I as default};
