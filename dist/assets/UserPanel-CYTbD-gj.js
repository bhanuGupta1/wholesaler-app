import{u as P,a as E,j as e,L as M,d as y}from"./index-Dy66ZVuQ.js";import{r as d}from"./vendor-DJ1oPbzn.js";import{t as _,q,b as z,c as J,d as $,u as S}from"./firebase-DMhjYMbV.js";const O=()=>{const{darkMode:t}=P(),{user:A}=E(),[j,k]=d.useState([]),[T,v]=d.useState(!0),[o,U]=d.useState(""),[m,C]=d.useState("all"),[b,R]=d.useState("all"),[V,Y]=d.useState(new Set),[h,f]=d.useState(null),[c,x]=d.useState(new Set);d.useEffect(()=>{const s=_(q(J(y,"users"),z("createdAt","desc")),r=>{const l=r.docs.map(a=>{var i;return{id:a.id,...a.data(),createdAt:((i=a.data().createdAt)==null?void 0:i.toDate())||new Date}});k(l),v(!1)},r=>{console.error("Error fetching users:",r),v(!1)});return()=>s()},[]);const p=(s,r="success")=>{f({message:s,type:r}),setTimeout(()=>f(null),4e3)},L=s=>{const{accountType:r,businessType:l}=s;switch(r){case"admin":return{label:"Administrator",color:"red",icon:"üëë"};case"manager":return{label:"Manager",color:"purple",icon:"üëî"};case"business":return l==="seller"?{label:"Business Seller",color:"blue",icon:"üè™"}:l==="buyer"?{label:"Business Buyer",color:"green",icon:"üõí"}:{label:"Business User",color:"blue",icon:"üè¢"};case"user":default:return{label:"Regular User",color:"gray",icon:"üë§"}}},B=s=>{const{status:r,approved:l}=s;return r==="pending_approval"||r==="pending"?{label:"Pending Approval",color:"yellow",icon:"‚è≥"}:l&&r==="active"?{label:"Active",color:"green",icon:"‚úÖ"}:r==="rejected"?{label:"Rejected",color:"red",icon:"‚ùå"}:r==="suspended"?{label:"Suspended",color:"orange",icon:"‚ö†Ô∏è"}:{label:"Unknown",color:"gray",icon:"‚ùì"}},N=j.filter(s=>{var i,g,w;const r=(((i=s.displayName)==null?void 0:i.toLowerCase())||"").includes(o.toLowerCase())||(((g=s.email)==null?void 0:g.toLowerCase())||"").includes(o.toLowerCase())||(((w=s.businessName)==null?void 0:w.toLowerCase())||"").includes(o.toLowerCase()),l=m==="all"||s.status===m,a=b==="all"||s.accountType===b;return r&&l&&a}),n=j.reduce((s,r)=>(s.all++,r.status==="pending_approval"||r.status==="pending"?s.pending++:r.approved&&r.status==="active"?s.active++:r.status==="rejected"?s.rejected++:r.status==="suspended"&&s.suspended++,s),{all:0,pending:0,active:0,rejected:0,suspended:0}),u=async(s,r)=>{if(!c.has(s)){x(l=>new Set(l).add(s));try{const l=$(y,"users",s),a={updatedAt:new Date};switch(r){case"approve":a.approved=!0,a.status="active",a.isActive=!0;break;case"reject":a.approved=!1,a.status="rejected",a.isActive=!1;break;case"suspend":a.approved=!1,a.status="suspended",a.isActive=!1;break;case"activate":a.approved=!0,a.status="active",a.isActive=!0;break}await S(l,a),p(`User ${r}d successfully`,"success")}catch(l){console.error(`Error ${r}ing user:`,l),p(`Failed to ${r} user`,"error")}finally{x(l=>{const a=new Set(l);return a.delete(s),a})}}},F=async(s,r,l=null)=>{if(!c.has(s)){x(a=>new Set(a).add(s));try{const a=$(y,"users",s),i={accountType:r,updatedAt:new Date};r==="business"&&l&&(i.businessType=l),await S(a,i),p("User role updated successfully","success")}catch(a){console.error("Error updating role:",a),p("Failed to update user role","error")}finally{x(a=>{const i=new Set(a);return i.delete(s),i})}}};return T?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:`text-xl ${t?"text-cyan-400":"text-blue-600"}`,children:"Loading user panel..."})}):e.jsxs("div",{className:`container mx-auto px-4 py-8 max-w-7xl ${t?"text-gray-200":"text-gray-800"}`,children:[h&&e.jsx("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${h.type==="success"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:h.message}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:`text-3xl font-bold ${t?"text-white":"text-gray-900"} mb-2`,children:"User Management Panel"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Manage user accounts, roles, and permissions across the platform"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:`${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-xl border p-4`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"üë•"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"} uppercase tracking-wide`,children:"Total Users"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-white":"text-gray-900"}`,children:n.all})]})]})}),e.jsx("div",{className:`${t?"bg-yellow-900/20 border-yellow-800":"bg-yellow-50 border-yellow-200"} rounded-xl border p-4`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"‚è≥"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-yellow-400":"text-yellow-600"} uppercase tracking-wide`,children:"Pending Approval"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-yellow-300":"text-yellow-800"}`,children:n.pending})]})]})}),e.jsx("div",{className:`${t?"bg-green-900/20 border-green-800":"bg-green-50 border-green-200"} rounded-xl border p-4`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-green-400":"text-green-600"} uppercase tracking-wide`,children:"Active Users"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-green-300":"text-green-800"}`,children:n.active})]})]})}),e.jsx("div",{className:`${t?"bg-red-900/20 border-red-800":"bg-red-50 border-red-200"} rounded-xl border p-4`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"‚ùå"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-red-400":"text-red-600"} uppercase tracking-wide`,children:"Rejected"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-red-300":"text-red-800"}`,children:n.rejected})]})]})}),e.jsx("div",{className:`${t?"bg-orange-900/20 border-orange-800":"bg-orange-50 border-orange-200"} rounded-xl border p-4`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-orange-400":"text-orange-600"} uppercase tracking-wide`,children:"Suspended"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-orange-300":"text-orange-800"}`,children:n.suspended})]})]})})]}),e.jsx("div",{className:`${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-xl border p-6 mb-8`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Search Users"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or business...",value:o,onChange:s=>U(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-blue-500 focus:border-blue-500`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Filter by Status"}),e.jsxs("select",{value:m,onChange:s=>C(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-blue-500 focus:border-blue-500`,children:[e.jsxs("option",{value:"all",children:["All Status (",n.all,")"]}),e.jsxs("option",{value:"pending_approval",children:["Pending Approval (",n.pending,")"]}),e.jsxs("option",{value:"active",children:["Active (",n.active,")"]}),e.jsxs("option",{value:"rejected",children:["Rejected (",n.rejected,")"]}),e.jsxs("option",{value:"suspended",children:["Suspended (",n.suspended,")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Filter by Type"}),e.jsxs("select",{value:b,onChange:s=>R(s.target.value),className:`w-full px-3 py-2 rounded-md ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-blue-500 focus:border-blue-500`,children:[e.jsx("option",{value:"all",children:"All Account Types"}),e.jsx("option",{value:"user",children:"Regular Users"}),e.jsx("option",{value:"business",children:"Business Accounts"}),e.jsx("option",{value:"manager",children:"Managers"}),e.jsx("option",{value:"admin",children:"Administrators"})]})]})]})}),n.pending>0&&e.jsxs("div",{className:`${t?"bg-yellow-900/10 border-yellow-800":"bg-yellow-50 border-yellow-200"} rounded-xl border p-6 mb-8`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:`text-lg font-semibold ${t?"text-yellow-300":"text-yellow-800"}`,children:["‚è≥ Pending Approvals (",n.pending,")"]}),e.jsx(M,{to:"/admin/approvals",className:`px-4 py-2 rounded-md text-sm font-medium ${t?"bg-yellow-600 text-black hover:bg-yellow-500":"bg-yellow-600 text-white hover:bg-yellow-700"} transition-colors`,children:"View All Pending ‚Üí"})]}),e.jsxs("p",{className:`text-sm ${t?"text-yellow-400":"text-yellow-700"}`,children:["You have ",n.pending," user accounts waiting for approval. These users cannot access their accounts until approved."]})]}),e.jsx("div",{className:`${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-xl border overflow-hidden`,children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:t?"bg-gray-900":"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"User Information"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Account Type & Role"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Business Information"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Joined"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${t?"text-gray-300":"text-gray-500"} uppercase tracking-wider`,children:"Actions"})]})}),e.jsx("tbody",{className:`${t?"bg-gray-800":"bg-white"} divide-y ${t?"divide-gray-700":"divide-gray-200"}`,children:N.map(s=>{const r=L(s),l=B(s);return e.jsxs("tr",{className:t?"hover:bg-gray-700":"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${t?"text-gray-200":"text-gray-900"}`,children:s.displayName||s.firstName+" "+s.lastName||"No Name"}),e.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:s.email}),s.phoneNumber&&e.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:["üìû ",s.phoneNumber]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${r.color}-100 text-${r.color}-800`,children:r.label}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:s.accountType+(s.businessType?"-"+s.businessType:""),onChange:a=>{const[i,g]=a.target.value.split("-");F(s.id,i,g)},disabled:c.has(s.id),className:`w-full text-xs px-2 py-1 rounded ${t?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-blue-500 focus:border-blue-500`,children:[e.jsx("option",{value:"user",children:"Regular User"}),e.jsx("option",{value:"business-seller",children:"Business Seller"}),e.jsx("option",{value:"business-buyer",children:"Business Buyer"}),e.jsx("option",{value:"manager",children:"Manager"}),A.accountType==="admin"&&e.jsx("option",{value:"admin",children:"Administrator"})]})})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:`text-sm ${t?"text-gray-300":"text-gray-900"}`,children:s.businessName||"Not specified"}),s.businessType&&e.jsx("div",{className:`text-xs ${t?"text-blue-400":"text-blue-600"} capitalize`,children:s.businessType==="seller"?"üè™ Seller":"üõí Buyer"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color==="green"?"bg-green-100 text-green-800":l.color==="yellow"?"bg-yellow-100 text-yellow-800":l.color==="red"?"bg-red-100 text-red-800":l.color==="orange"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[l.icon," ",l.label]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:s.createdAt.toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.status==="pending_approval"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(s.id,"approve"),disabled:c.has(s.id),className:"bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700 disabled:opacity-50 transition-colors",children:"‚úÖ Approve"}),e.jsx("button",{onClick:()=>u(s.id,"reject"),disabled:c.has(s.id),className:"bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-700 disabled:opacity-50 transition-colors",children:"‚ùå Reject"})]}),s.status==="active"&&e.jsx("button",{onClick:()=>u(s.id,"suspend"),disabled:c.has(s.id),className:"bg-orange-600 text-white px-2 py-1 rounded text-xs hover:bg-orange-700 disabled:opacity-50 transition-colors",children:"‚ö†Ô∏è Suspend"}),(s.status==="suspended"||s.status==="rejected")&&e.jsx("button",{onClick:()=>u(s.id,"activate"),disabled:c.has(s.id),className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 disabled:opacity-50 transition-colors",children:"üîÑ Activate"})]})})]},s.id)})})]}),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üë•"}),e.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-500"}`,children:"No users found matching your criteria"})]})]})})]})};export{O as default};
