import{b as ce,y as oe,a as me,u as ge,x as ue,d as G,j as e}from"./index-Dy66ZVuQ.js";import{r as h}from"./vendor-DJ1oPbzn.js";import{c as xe,g as be,d as he,h as ye}from"./firebase-DMhjYMbV.js";import{v as pe,c as fe}from"./orderService-BGzdWnTg.js";const $e=()=>{const u=ce(),F=oe(),{user:c}=me(),{darkMode:t}=ge(),{cart:p,clearCart:M}=ue(),[O,B]=h.useState([]),[f,N]=h.useState([]),[o,I]=h.useState([]),[m,K]=h.useState({name:(c==null?void 0:c.displayName)||"",email:(c==null?void 0:c.email)||"",phone:"",address:"",city:"",zipCode:""}),[a,D]=h.useState({paymentMethod:"credit_card",cardNumber:"",expiryDate:"",cvv:"",cardHolderName:"",accountNumber:"",routingNumber:"",accountHolderName:"",bankName:"",accountType:"checking",billingAddressSame:!0,billingAddress:"",billingCity:"",billingZipCode:""}),[X,E]=h.useState(!0),[H,U]=h.useState(!1),[Q,C]=h.useState(""),[P,q]=h.useState(1),[T,ee]=h.useState(""),[w,R]=h.useState("direct"),[j,v]=h.useState("guest"),[y,L]=h.useState(null);h.useEffect(()=>{const s=f.map(r=>se(r));I(s)},[f]);const se=s=>{if(!s.bulkPricing||typeof s.bulkPricing!="object")return{...s,effectivePrice:s.price,hasBulkDiscount:!1};const i=Object.keys(s.bulkPricing).map(n=>parseInt(n)).filter(n=>!isNaN(n)).sort((n,l)=>l-n).find(n=>s.quantity>=n);if(i){const n=s.bulkPricing[i.toString()],l=s.price-n,g=l/s.price*100;return{...s,effectivePrice:n,hasBulkDiscount:!0,bulkPricing:{...s.bulkPricing,isBulkPrice:!0,originalPrice:s.price,bulkDiscount:g,bulkTier:i,appliedPrice:n,savings:l}}}return{...s,effectivePrice:s.price,hasBulkDiscount:!1,bulkPricing:{...s.bulkPricing,isBulkPrice:!1}}};h.useEffect(()=>{var s;if((s=F.state)!=null&&s.fromCart&&p.length>0){R("cart");const r=p.map(i=>({...i,quantity:i.quantity}));N(r),q(2)}},[F.state,p]),h.useEffect(()=>{(async()=>{var r,i,n,l;if(!(c!=null&&c.uid)){v("guest"),L(null);return}try{const g=he(G,"users",c.uid),d=await ye(g);if(d.exists()){const x=d.data(),k=x.accountType,S=x.businessType;v(k==="admin"||k==="manager"?"admin":k==="business"?"business":"customer"),L({accountType:k,businessType:S})}else(r=c.email)!=null&&r.includes("admin")?v("admin"):(i=c.email)!=null&&i.includes("business")?v("business"):v("customer"),L(null)}catch(g){console.error("Error fetching user role:",g),(n=c.email)!=null&&n.includes("admin")?v("admin"):(l=c.email)!=null&&l.includes("business")?v("business"):v("customer"),L(null)}})()},[c]),h.useEffect(()=>{te()},[]);const te=async()=>{try{E(!0);const s=xe(G,"products"),i=(await be(s)).docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.stock>0);B(i),E(!1)}catch(s){console.error("Error fetching products:",s),C("Failed to load products"),E(!1)}},_=O.filter(s=>{var r;return s.name.toLowerCase().includes(T.toLowerCase())||((r=s.category)==null?void 0:r.toLowerCase().includes(T.toLowerCase()))}),re=(s,r)=>{const i=f.findIndex(n=>n.id===s.id);if(i>-1){const n=[...f];n[i].quantity=Math.min(n[i].quantity+r,s.stock),N(n)}else N([...f,{...s,quantity:Math.min(r,s.stock)}])},V=s=>{N(f.filter(r=>r.id!==s))},W=(s,r)=>{if(r<=0){V(s);return}const i=O.find(l=>l.id===s)||f.find(l=>l.id===s),n=f.map(l=>l.id===s?{...l,quantity:Math.min(r,i.stock)}:l);N(n)},J=()=>{let s=0,r=0,i=0,n=0,l=0,g=0;o.forEach(x=>{const k=x.effectivePrice||x.price,S=x.price;s+=k*x.quantity,r+=S*x.quantity,x.hasBulkDiscount&&(i+=(S-k)*x.quantity)}),j==="business"&&(n=s*.15,(o.reduce((k,S)=>k+S.quantity,0)>=10||s>=500)&&(l=s*.05)),j==="customer"&&(g=(s-n-l)*.15);const d=s-n-l+g;return{subtotal:s,originalSubtotal:r,itemLevelBulkSavings:i,businessDiscount:n,additionalBulkDiscount:l,totalBulkSavings:i,totalBusinessSavings:n+l,totalSavings:i+n+l,tax:g,total:d}},ae=()=>{if(j!=="business")return null;const s=o.reduce((l,g)=>l+g.quantity,0),r=o.reduce((l,g)=>l+(g.effectivePrice||g.price)*g.quantity,0);if(s>=10||r>=500)return{qualified:!0,message:"✓ Additional 5% Bulk Qualified"};const i=Math.max(0,10-s),n=Math.max(0,500-r);return i>0&&n>0?{qualified:!1,message:`Need ${i} more items OR $${n.toFixed(0)} more for extra 5% bulk discount`}:i>0?{qualified:!1,message:`Need ${i} more items for extra 5% bulk discount`}:{qualified:!1,message:`Need $${n.toFixed(0)} more for extra 5% bulk discount`}},A=s=>{const{name:r,value:i}=s.target;K(n=>({...n,[r]:i}))},$=s=>{const{name:r,value:i,type:n,checked:l}=s.target;D(g=>({...g,[r]:n==="checkbox"?l:i}))},ie=s=>{const r=s.replace(/\s+/g,"").replace(/[^0-9]/gi,""),i=r.match(/\d{4,16}/g),n=i&&i[0]||"",l=[];for(let g=0,d=n.length;g<d;g+=4)l.push(n.substring(g,g+4));return l.length?l.join(" "):r},ne=s=>{const r=s.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return r.length>=2?r.substring(0,2)+(r.length>2?"/"+r.substring(2,4):""):r},z=()=>["name","email","phone","address","city"].every(r=>m[r].trim()!==""),Z=()=>a.paymentMethod==="credit_card"?a.cardNumber.replace(/\s/g,"").length>=13&&a.expiryDate.length===5&&a.cvv.length>=3&&a.cardHolderName.trim()!=="":a.accountNumber.trim()!==""&&a.routingNumber.trim()!==""&&a.accountHolderName.trim()!==""&&a.bankName.trim()!=="",Y=()=>{if(p.length>0){const s=p.map(r=>({...r,quantity:r.quantity}));N(s),R("cart"),q(2)}},le=()=>{N([]),R("direct"),q(1)},de=async()=>{if(!c){C("Please sign in to place an order");return}if(f.length===0){C("Please select at least one product");return}if(!z()){C("Please fill in all required customer information");return}if(!Z()){C("Please fill in all required payment information");return}try{U(!0),C("");const s=o.filter(d=>{const x=d.effectivePrice??d.price;return x==null||x<0});if(s.length>0){console.error("Items with invalid prices:",s),C("Some items have invalid pricing. Please refresh the page and try again.");return}const r=J(),i=a.billingAddressSame?{address:m.address,city:m.city,zipCode:m.zipCode}:{address:a.billingAddress,city:a.billingCity,zipCode:a.billingZipCode},n=o.map(d=>{const x=d.effectivePrice??d.price??0,k=d.price??0,S=d.quantity??0;return{productId:d.id||d.productId,productName:d.name||d.productName,price:k,effectivePrice:x,quantity:S,subtotal:x*S,hasBulkDiscount:d.hasBulkDiscount||!1,bulkPricing:d.bulkPricing||null,sku:d.sku||"",category:d.category||"",imageUrl:d.imageUrl||""}});try{pe(n)}catch(d){C(d.message);return}const l={customerName:m.name,customerEmail:m.email,customerPhone:m.phone,shippingAddress:{address:m.address,city:m.city,zipCode:m.zipCode},billingAddress:i,paymentInfo:{paymentMethod:a.paymentMethod,...a.paymentMethod==="credit_card"?{cardLastFour:a.cardNumber.slice(-4),cardHolderName:a.cardHolderName,expiryDate:a.expiryDate}:{accountLastFour:a.accountNumber.slice(-4),accountHolderName:a.accountHolderName,bankName:a.bankName,accountType:a.accountType}},userId:c.uid,userRole:j,userAccountType:y==null?void 0:y.accountType,userBusinessType:y==null?void 0:y.businessType,orderSource:w,items:n,itemCount:o.reduce((d,x)=>d+(x.quantity||0),0),originalSubtotal:r.originalSubtotal,subtotal:r.subtotal,itemLevelBulkSavings:r.itemLevelBulkSavings,businessDiscount:r.businessDiscount,additionalBulkDiscount:r.additionalBulkDiscount,totalBusinessSavings:r.totalBusinessSavings,totalBulkSavings:r.totalBulkSavings,totalSavings:r.totalSavings,taxAmount:r.tax,tax:r.tax,total:r.total,totalAmount:r.total,hasItemLevelBulkDiscounts:r.itemLevelBulkSavings>0,hasBusinessDiscounts:r.totalBusinessSavings>0,qualifiesForAdditionalBulkDiscount:r.additionalBulkDiscount>0,status:"pending",paymentStatus:"pending",currency:"NZD",country:"New Zealand",timezone:"Pacific/Auckland"};console.log("Creating order with validated data:",l);const g=await fe(l);w==="cart"&&M(),await new Promise(d=>setTimeout(d,2e3)),U(!1),u(`/orders/${g}`,{state:{message:"Order placed successfully!"}})}catch(s){console.error("Error creating order:",s),C(s.message||"Failed to create order. Please try again."),U(!1)}};if(X)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})});const b=J();return e.jsx("div",{className:`min-h-screen ${t?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:`text-2xl font-bold ${t?"text-white":"text-gray-900"}`,children:"Create New Order"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[p.length>0&&w==="direct"&&e.jsxs("button",{onClick:Y,className:`px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-600 hover:text-white transition-colors ${t?"border-indigo-400 text-indigo-400 hover:bg-indigo-400 hover:text-gray-900":""}`,children:["Import from Cart (",p.length," items)"]}),w==="cart"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:"🛒 From Cart"}),e.jsx("button",{onClick:le,className:`px-3 py-1 text-sm border rounded ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Start Fresh"})]})]})]}),e.jsx("div",{className:"flex items-center mt-2",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${j==="business"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":j==="customer"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":j==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:[j==="business"&&e.jsxs(e.Fragment,{children:[(y==null?void 0:y.businessType)==="seller"?"🏪":(y==null?void 0:y.businessType)==="buyer"?"🛒":"🏢","Business Account ",y!=null&&y.businessType?`(${y.businessType.charAt(0).toUpperCase()+y.businessType.slice(1)})`:""," - 15% Business + Auto Bulk + 5% Extra Available",(()=>{const s=ae();return s?e.jsx("span",{className:`ml-2 text-xs px-2 py-1 rounded-full ${s.qualified?"bg-green-500 text-white":"bg-yellow-500 text-white"}`,children:s.message}):null})()]}),j==="customer"&&"👤 Customer Account - 15% Tax Applied + Auto Bulk Pricing",j==="admin"&&"⚙️ Admin Account - No Additional Charges",j==="guest"&&"👤 Guest User"]})}),b.itemLevelBulkSavings>0&&e.jsx("div",{className:`mt-4 p-4 rounded-lg ${t?"bg-green-900/20 border-green-800":"bg-green-50 border-green-200"} border`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-2xl mr-3",children:"🎉"}),e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold ${t?"text-green-300":"text-green-800"}`,children:["Auto Bulk Pricing Applied! Saving $",b.itemLevelBulkSavings.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${t?"text-green-200":"text-green-700"}`,children:[o.filter(s=>s.hasBulkDiscount).length," items automatically qualified for volume discounts"]})]})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-center",children:[{num:1,label:"Select Products",icon:"🛍️"},{num:2,label:"Customer & Payment Info",icon:"📋"},{num:3,label:"Review & Pay",icon:"💳"}].map((s,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center px-4 py-2 rounded-lg ${P>=s.num?"bg-indigo-600 text-white":t?"bg-gray-700 text-gray-400":"bg-gray-200 text-gray-600"}`,children:[e.jsx("span",{className:"mr-2",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label}),s.num===1&&w==="cart"&&e.jsx("span",{className:"ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full",children:"From Cart"})]}),r<2&&e.jsx("div",{className:`w-8 h-0.5 mx-2 ${P>s.num?"bg-indigo-600":t?"bg-gray-700":"bg-gray-300"}`})]},s.num))})}),Q&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border-l-4 ${t?"bg-red-900/30 border-red-800 text-red-400":"bg-red-50 border-red-400 text-red-700"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚠️"}),e.jsx("p",{className:"text-sm",children:Q})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[P===1&&e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[p.length>0&&w==="direct"&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${t?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${t?"text-blue-400":"text-blue-700"}`,children:"Items in Cart"}),e.jsxs("p",{className:`text-sm ${t?"text-blue-300":"text-blue-600"}`,children:["You have ",p.length," item(s) in your cart. Import them to create an order quickly."]})]}),e.jsx("button",{onClick:Y,className:"px-4 py-2 rounded-lg font-medium bg-blue-600 hover:bg-blue-700 text-white",children:"Import Cart"})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search products...",value:T,onChange:s=>ee(s.target.value),className:`block w-full pl-10 pr-3 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300"}`})]})}),e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Available Products (",_.length,")"]}),_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📦"}),e.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-500"}`,children:T?"No products found matching your search.":"No products available for order."})]}):e.jsx("div",{className:"space-y-3",children:_.map(s=>e.jsx(je,{product:s,onAddToOrder:re,darkMode:t,isSelected:f.find(r=>r.id===s.id)},s.id))})]}),P===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"📋"}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",value:m.name,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:m.email,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Phone *"}),e.jsx("input",{type:"tel",name:"phone",value:m.phone,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"City *"}),e.jsx("input",{type:"text",name:"city",value:m.city,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Address *"}),e.jsx("input",{type:"text",name:"address",value:m.address,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Zip Code"}),e.jsx("input",{type:"text",name:"zipCode",value:m.zipCode,onChange:A,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]})]})]}),e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"💳"}),"Payment Information"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-3`,children:"Payment Method *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${a.paymentMethod==="credit_card"?t?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":t?"border-gray-600":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"credit_card",checked:a.paymentMethod==="credit_card",onChange:$,className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"💳 Credit Card"}),e.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Visa, MasterCard, etc."})]})]}),e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${a.paymentMethod==="bank_account"?t?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":t?"border-gray-600":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank_account",checked:a.paymentMethod==="bank_account",onChange:$,className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"🏦 Bank Account"}),e.jsx("div",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"Direct bank transfer"})]})]})]})]}),a.paymentMethod==="credit_card"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Card Holder Name *"}),e.jsx("input",{type:"text",name:"cardHolderName",value:a.cardHolderName,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Card Number *"}),e.jsx("input",{type:"text",name:"cardNumber",value:a.cardNumber,onChange:s=>{const r=ie(s.target.value);D(i=>({...i,cardNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"1234 5678 9012 3456",maxLength:"19",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Expiry Date *"}),e.jsx("input",{type:"text",name:"expiryDate",value:a.expiryDate,onChange:s=>{const r=ne(s.target.value);D(i=>({...i,expiryDate:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"MM/YY",maxLength:"5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"CVV *"}),e.jsx("input",{type:"text",name:"cvv",value:a.cvv,onChange:s=>{const r=s.target.value.replace(/\D/g,"");D(i=>({...i,cvv:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"123",maxLength:"4",required:!0})]})]}),a.paymentMethod==="bank_account"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Holder Name *"}),e.jsx("input",{type:"text",name:"accountHolderName",value:a.accountHolderName,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Bank Name *"}),e.jsx("input",{type:"text",name:"bankName",value:a.bankName,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"Chase Bank",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Type *"}),e.jsxs("select",{name:"accountType",value:a.accountType,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!0,children:[e.jsx("option",{value:"checking",children:"Checking"}),e.jsx("option",{value:"savings",children:"Savings"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Account Number *"}),e.jsx("input",{type:"text",name:"accountNumber",value:a.accountNumber,onChange:s=>{const r=s.target.value.replace(/\D/g,"");D(i=>({...i,accountNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"123456789",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Routing Number *"}),e.jsx("input",{type:"text",name:"routingNumber",value:a.routingNumber,onChange:s=>{const r=s.target.value.replace(/\D/g,"");D(i=>({...i,routingNumber:r}))},className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"021000021",maxLength:"9",required:!0})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",name:"billingAddressSame",checked:a.billingAddressSame,onChange:$,className:"mr-3"}),e.jsx("label",{className:`text-sm font-medium ${t?"text-gray-300":"text-gray-700"}`,children:"Billing address is the same as shipping address"})]}),!a.billingAddressSame&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Billing Address *"}),e.jsx("input",{type:"text",name:"billingAddress",value:a.billingAddress,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!a.billingAddressSame})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"City *"}),e.jsx("input",{type:"text",name:"billingCity",value:a.billingCity,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!a.billingAddressSame})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${t?"text-gray-300":"text-gray-700"} mb-2`,children:"Zip Code *"}),e.jsx("input",{type:"text",name:"billingZipCode",value:a.billingZipCode,onChange:$,className:`w-full px-4 py-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,required:!a.billingAddressSame})]})]})]})]})]}),P===3&&e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6`,children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"✅"}),"Review & Confirm Order"]}),w==="cart"&&e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:"🛒 Order created from cart items"})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Order Items"}),e.jsx("div",{className:"space-y-3",children:o.map(s=>{const r=s.effectivePrice||s.price,i=s.hasBulkDiscount?(s.price-r)*s.quantity:0;return e.jsxs("div",{className:`flex justify-between items-center p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-12 h-12 ${t?"bg-gray-600":"bg-gray-200"} rounded-lg flex items-center justify-center`,children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-12 h-12 object-cover rounded-lg"}):e.jsx("span",{children:"📦"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:["$",r.toFixed(2)," × ",s.quantity,s.hasBulkDiscount&&e.jsxs("span",{className:"ml-2 text-green-600 font-medium",children:["(was $",s.price.toFixed(2),")"]})]}),s.hasBulkDiscount&&e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["🎯 Auto bulk: ",s.bulkPricing.bulkDiscount.toFixed(0),"% off • ",s.bulkPricing.bulkTier,"+ units"]})})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-lg",children:["$",(r*s.quantity).toFixed(2)]}),i>0&&e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["Saved $",i.toFixed(2)]})]})]},s.id)})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Shipping Information"}),e.jsx("div",{className:`p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.name}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:m.email}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:m.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:m.address}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:[m.city," ",m.zipCode]})]})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Payment Information"}),e.jsx("div",{className:`p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:a.paymentMethod==="credit_card"?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"💳 Credit Card"}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:["•••• •••• •••• ",a.cardNumber.slice(-4)]}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:a.cardHolderName})]}):e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"🏦 Bank Account"}),e.jsxs("p",{className:t?"text-gray-300":"text-gray-600",children:[a.bankName," - •••••",a.accountNumber.slice(-4)]}),e.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:a.accountHolderName})]})})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-xl shadow-lg p-6 sticky top-4`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"🛒"}),"Order Summary",w==="cart"&&e.jsx("span",{className:"ml-2 text-xs bg-green-500 text-white px-2 py-1 rounded-full",children:"Cart"})]}),o.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🛍️"}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-500"}`,children:"No products selected"}),p.length>0&&w==="direct"&&e.jsxs("button",{onClick:Y,className:"mt-3 text-sm text-indigo-600 dark:text-indigo-400 hover:underline",children:["Import ",p.length," items from cart"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:o.map(s=>e.jsxs("div",{className:`p-3 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-sm font-medium truncate pr-2",children:s.name}),e.jsx("button",{onClick:()=>V(s.id),className:"text-red-500 hover:text-red-700 ml-2",children:"×"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>W(s.id,s.quantity-1),className:`w-6 h-6 rounded-full ${t?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"} flex items-center justify-center text-sm`,children:"−"}),e.jsx("span",{className:"text-sm font-medium",children:s.quantity}),e.jsx("button",{onClick:()=>W(s.id,s.quantity+1),className:`w-6 h-6 rounded-full ${t?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"} flex items-center justify-center text-sm`,children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold",children:["$",((s.effectivePrice||s.price)*s.quantity).toFixed(2)]}),s.hasBulkDiscount&&e.jsx("p",{className:"text-xs text-green-600",children:"Auto bulk applied"})]})]})]},s.id))}),e.jsx("div",{className:`pt-4 border-t ${t?"border-gray-600":"border-gray-200"}`,children:e.jsxs("div",{className:"space-y-2",children:[b.totalSavings>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:`${t?"text-gray-400":"text-gray-500"} line-through`,children:"Original Subtotal:"}),e.jsxs("span",{className:`${t?"text-gray-400":"text-gray-500"} line-through`,children:["$",b.originalSubtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",b.subtotal.toFixed(2)]})]}),b.itemLevelBulkSavings>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"🎯 Auto Bulk Discounts:"}),e.jsxs("span",{children:["-$",b.itemLevelBulkSavings.toFixed(2)]})]}),b.businessDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Business Discount (15%):"}),e.jsxs("span",{children:["-$",b.businessDiscount.toFixed(2)]})]}),j==="business"&&b.additionalBulkDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"🎯 Extra Bulk Discount (5%):"}),e.jsxs("span",{children:["-$",b.additionalBulkDiscount.toFixed(2)]})]}),b.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax (15%):"}),e.jsxs("span",{children:["$",b.tax.toFixed(2)]})]}),e.jsxs("div",{className:`flex justify-between font-bold text-lg pt-2 border-t ${t?"border-gray-600":"border-gray-200"}`,children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",b.total.toFixed(2)]})]}),b.totalSavings>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400 font-medium pt-2 border-t border-green-200 dark:border-green-800",children:[e.jsx("span",{children:"💰 Total Savings:"}),e.jsxs("span",{children:["$",b.totalSavings.toFixed(2)]})]})]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[P===1&&e.jsxs("button",{onClick:()=>q(2),disabled:o.length===0,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${o.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:["Continue to Customer Info",e.jsx("span",{className:"ml-2",children:"→"})]}),P===2&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>q(3),disabled:!z()||!Z(),className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${!z()||!Z()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:["Review Order",e.jsx("span",{className:"ml-2",children:"→"})]}),e.jsx("button",{onClick:()=>q(1),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Products"})]}),P===3&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:de,disabled:H,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${H?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white`,children:H?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Place Order • $",b.total.toFixed(2),e.jsx("span",{className:"ml-2",children:"✓"})]})}),e.jsx("button",{onClick:()=>q(2),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Customer Info"})]}),w==="cart"&&P===1&&e.jsx("button",{onClick:()=>u("/cart"),className:`w-full py-2 px-4 rounded-lg font-medium border ${t?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"← Back to Cart"})]}),e.jsx("div",{className:`mt-4 p-3 rounded-lg ${t?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-200"} border text-xs`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2",children:"🔒"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${t?"text-blue-400":"text-blue-700"}`,children:"Secure Payment"}),e.jsx("p",{className:`${t?"text-blue-300":"text-blue-600"} mt-1`,children:"Your payment information is encrypted and secure."}),b.totalSavings>0&&e.jsx("p",{className:`${t?"text-green-300":"text-green-600"} mt-1 font-medium`,children:"Auto discounts applied & locked in!"})]})]})})]})})]})]})})},je=({product:u,onAddToOrder:F,darkMode:c,isSelected:t})=>{const[p,M]=h.useState(1),B=(()=>{if(!u.bulkPricing||typeof u.bulkPricing!="object")return null;const N=Object.keys(u.bulkPricing).map(o=>parseInt(o)).filter(o=>!isNaN(o)).sort((o,I)=>o-I).find(o=>p>=o);if(N){const o=u.bulkPricing[N.toString()],m=(u.price-o)/u.price*100;return{bulkPrice:o,discountPercent:m,tier:N}}return null})();return e.jsx("div",{className:`border rounded-lg p-4 transition-all hover:shadow-md ${t?c?"border-indigo-500 bg-indigo-900/20":"border-indigo-500 bg-indigo-50":c?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 ${c?"bg-gray-600":"bg-gray-100"} rounded-lg flex items-center justify-center flex-shrink-0`,children:u.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u.name,className:"w-12 h-12 object-cover rounded-lg"}):e.jsx("span",{className:"text-xl",children:"📦"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:u.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[B?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["$",B.bulkPrice.toFixed(2)]}),e.jsxs("span",{className:`line-through ${c?"text-gray-500":"text-gray-400"}`,children:["$",u.price.toFixed(2)]}),e.jsxs("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full font-semibold",children:[B.discountPercent.toFixed(0),"% OFF"]})]}):e.jsxs("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:["$",u.price.toFixed(2)]}),e.jsxs("span",{className:`${c?"text-gray-400":"text-gray-500"}`,children:["Stock: ",u.stock]})]}),B&&e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["🎯 Auto bulk pricing - ",B.tier,"+ units"]}),u.category&&e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${c?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:u.category})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:`text-xs ${c?"text-gray-400":"text-gray-500"}`,children:"Qty:"}),e.jsx("input",{type:"number",min:"1",max:u.stock,value:p,onChange:f=>M(Math.max(1,Math.min(u.stock,parseInt(f.target.value)||1))),className:`w-16 px-2 py-1 border rounded text-sm text-center ${c?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),e.jsx("button",{onClick:()=>F(u,p),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors",children:t?"Add More":"Add"})]})]})})};export{$e as default};
