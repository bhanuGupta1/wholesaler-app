import{u as P,h as k,i as F,r as d,k as E,e as T,d as p,b as C,j as e,g as O,c as L,L as H,q,l as z}from"./index-l2F0ffZz.js";const Q=r=>r.isAdmin||r.role==="admin"||r.accountType==="admin"?"Admin":r.isManager||r.role==="manager"||r.accountType==="manager"?"Manager":r.businessType==="buyer"?"Business Buyer":r.businessType==="seller"?"Business Seller":r.role==="business"||r.accountType==="business"?"Business User":"User",V=({darkMode:r})=>{const[s,y]=d.useState({database:"checking",api:"checking",storage:"checking",uptime:"calculating..."}),[A,j]=d.useState(new Date),w=d.useCallback(async()=>{const u=Date.now();try{const v=await O(q(L(p,"products"),z(1)))?"good":"error",D=Date.now()-u,N=D<1e3?"good":D<3e3?"warning":"error",b=Math.random()>.1?"good":"warning",$=(99.5+Math.random()*.4).toFixed(1)+"%";y({database:v,api:N,storage:b,uptime:$}),j(new Date)}catch(m){console.error("Health check failed:",m),y({database:"error",api:"error",storage:"error",uptime:"unknown"})}},[]);return d.useEffect(()=>{w();const u=setInterval(w,3e4);return()=>clearInterval(u)},[w]),e.jsxs("div",{className:`${r?"bg-gray-800 border-gray-700":"bg-white border-gray-100"} rounded-xl shadow-lg overflow-hidden border`,children:[e.jsxs("div",{className:`px-6 py-4 border-b ${r?"border-gray-700":"border-gray-100"} flex justify-between items-center`,children:[e.jsx("h2",{className:`text-xl font-bold ${r?"text-white":"text-gray-800"}`,children:"System Health"}),e.jsx("button",{onClick:w,className:"text-xs px-3 py-1 rounded-md bg-blue-600 hover:bg-blue-700 text-white transition-colors",children:"Refresh"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[Object.entries(s).map(([u,m])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`capitalize ${r?"text-gray-300":"text-gray-700"}`,children:u}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m==="good"?r?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800":m==="warning"?r?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-800":m==="checking"?r?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-800":r?"bg-red-900/30 text-red-400":"bg-red-100 text-red-800"}`,children:m})]},u)),e.jsxs("div",{className:`text-xs ${r?"text-gray-500":"text-gray-400"} pt-2 border-t ${r?"border-gray-700":"border-gray-200"}`,children:["Last check: ",A.toLocaleTimeString()]})]})]})},J=({users:r,darkMode:s,onDeleteUser:y,onUpdateUserRole:A,onRefreshUsers:j,onBulkAction:w})=>{const[u,m]=d.useState(""),[v,D]=d.useState("all"),[N,b]=d.useState(!1),[$,R]=d.useState(null),[f,n]=d.useState([]),a=t=>t.role==="admin"||t.accountType==="admin"?"admin":t.role==="manager"||t.accountType==="manager"?"manager":(t.role==="business"||t.accountType==="business")&&t.businessType==="buyer"?"business-buyer":(t.role==="business"||t.accountType==="business")&&t.businessType==="seller"?"business-seller":"user",c=t=>{switch(t){case"admin":return"Admin";case"manager":return"Manager";case"business-buyer":return"Business Buyer";case"business-seller":return"Business Seller";case"user":return"User";default:return"User"}},l=d.useMemo(()=>{let t=r;if(v!=="all"&&(t=t.filter(o=>a(o)===v)),u.trim()){const o=u.toLowerCase();t=t.filter(h=>{var x;return h.email.toLowerCase().includes(o)||((x=h.displayName)==null?void 0:x.toLowerCase().includes(o))})}return t},[r,v,u]),i=(t,o="success")=>{R({message:t,type:o}),setTimeout(()=>R(null),3e3)},g=async(t,o)=>{if(window.confirm(`Are you sure you want to delete user ${o}? This action cannot be undone.`)){b(!0);try{await y(t),i("User deleted successfully","success"),j()}catch(h){console.error("Error deleting user:",h),i("Failed to delete user: "+h.message,"error")}finally{b(!1)}}},U=async(t,o,h)=>{b(!0);try{let x={};switch(o){case"admin":x={role:"admin",accountType:"admin",businessType:null};break;case"manager":x={role:"manager",accountType:"manager",businessType:null};break;case"business-buyer":x={role:"business",accountType:"business",businessType:"buyer"};break;case"business-seller":x={role:"business",accountType:"business",businessType:"seller"};break;case"user":default:x={role:"user",accountType:"user",businessType:null};break}await A(t,x),i(`User role updated to ${c(o)}`,"success")}catch(x){console.error("Error updating user role:",x),i("Failed to update user role: "+x.message,"error")}finally{b(!1)}},S=async t=>{if(f.length===0){i("Please select users first","error");return}const o=t==="delete"?`Delete ${f.length} selected users?`:`${t} ${f.length} selected users?`;if(window.confirm(o)){b(!0);try{await w(f,t),n([]),i(`Bulk ${t} completed successfully`,"success"),j()}catch(h){i(`Bulk ${t} failed: `+h.message,"error")}finally{b(!1)}}},B=t=>{n(o=>o.includes(t)?o.filter(h=>h!==t):[...o,t])};return e.jsxs("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-100"} rounded-xl shadow-lg overflow-hidden border`,children:[$&&e.jsx("div",{className:`mx-6 mt-6 p-3 rounded-lg ${$.type==="success"?s?"bg-green-900/20 border-green-800 text-green-400":"bg-green-50 border-green-200 text-green-800":s?"bg-red-900/20 border-red-800 text-red-400":"bg-red-50 border-red-200 text-red-800"} border text-sm`,children:$.message}),e.jsxs("div",{className:`px-6 py-4 border-b ${s?"border-gray-700":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-white":"text-gray-800"}`,children:"User Management"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(H,{to:"/admin/pending-approvals",className:"px-3 py-1 rounded-md text-sm bg-purple-600 hover:bg-purple-700 text-white transition-colors",children:"Pending Approvals"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:u,onChange:t=>m(t.target.value),className:`px-3 py-1 rounded-md text-sm ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500`}),e.jsxs("select",{value:v,onChange:t=>D(t.target.value),className:`px-3 py-1 rounded-md text-sm ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500`,children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"business-buyer",children:"Business Buyer"}),e.jsx("option",{value:"business-seller",children:"Business Seller"}),e.jsx("option",{value:"user",children:"Regular User"})]}),e.jsx("button",{onClick:j,disabled:N,className:"px-3 py-1 rounded-md text-sm bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",children:N?"Loading...":"Refresh"})]})]}),f.length>0&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("span",{className:`text-sm ${s?"text-gray-300":"text-gray-700"}`,children:[f.length," selected:"]}),e.jsx("button",{onClick:()=>S("activate"),className:"text-sm text-green-600 hover:text-green-800 font-medium",children:"Activate"}),e.jsx("button",{onClick:()=>S("deactivate"),className:"text-sm text-yellow-600 hover:text-yellow-800 font-medium",children:"Deactivate"}),e.jsx("button",{onClick:()=>S("delete"),className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Delete"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:`${s?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-100"} border-b`,children:[e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:e.jsx("input",{type:"checkbox",onChange:t=>{t.target.checked?n(l.map(o=>o.id)):n([])},checked:f.length===l.length&&l.length>0})}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:"User"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:"Role"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:"Created"}),e.jsx("th",{className:`px-6 py-3 text-xs font-medium ${s?"text-gray-400":"text-gray-500"} uppercase`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${s?"divide-gray-700":"divide-gray-100"}`,children:l.map(t=>e.jsxs("tr",{className:`${s?"hover:bg-gray-700":"hover:bg-gray-50"} transition-colors`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:f.includes(t.id),onChange:()=>B(t.id)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-8 w-8 rounded-full ${s?"bg-gray-600":"bg-gray-200"} flex items-center justify-center`,children:t.displayName?t.displayName.charAt(0).toUpperCase():t.email.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:`text-sm font-medium ${s?"text-gray-200":"text-gray-900"}`,children:t.displayName||"No name"}),e.jsx("div",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium ${s?"text-gray-200":"text-gray-900"} mb-1`,children:Q(t)}),e.jsxs("select",{value:a(t),onChange:o=>U(t.id,o.target.value),disabled:N,className:`text-xs rounded-md ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300"} border focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50`,children:[e.jsx("option",{value:"user",children:"Regular User"}),e.jsx("option",{value:"business-buyer",children:"Business Buyer"}),e.jsx("option",{value:"business-seller",children:"Business Seller"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.active!==!1?s?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800":s?"bg-red-900/30 text-red-400":"bg-red-100 text-red-800"}`,children:t.active!==!1?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-sm ${s?"text-gray-400":"text-gray-500"}`,children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>g(t.id,t.email),disabled:N,className:`text-sm ${s?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-800"} font-medium disabled:opacity-50`,children:"Delete"})})})]},t.id))})]}),l.length===0&&e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:`${s?"text-gray-400":"text-gray-500"}`,children:"No users found with the current filters."})})]})]})},K=()=>{const{darkMode:r}=P();k(),F();const[s,y]=d.useState({totalUsers:0,totalOrders:0,totalRevenue:0,totalProducts:0,lowStockProducts:0,pendingOrders:0,allOrders:[],users:[]}),[A,j]=d.useState(!0),[w,u]=d.useState(null),[m,v]=d.useState(null),D=(n,a="success")=>{v({message:n,type:a}),setTimeout(()=>v(null),3e3)},N=async()=>{try{const n=L(p,"users");return(await O(n)).docs.map(l=>{var i,g;return{id:l.id,...l.data(),createdAt:((g=(i=l.data().createdAt)==null?void 0:i.toDate)==null?void 0:g.call(i))||new Date}})}catch{return console.log("No users collection found, creating demo users"),[{id:"demo-admin-1",email:"admin@company.com",displayName:"Admin User",role:"admin",accountType:"admin",active:!0,createdAt:new Date(Date.now()-30*24*60*60*1e3)},{id:"demo-manager-1",email:"manager@company.com",displayName:"Manager User",role:"manager",accountType:"manager",active:!0,createdAt:new Date(Date.now()-20*24*60*60*1e3)},{id:"demo-business-buyer-1",email:"buyer@company.com",displayName:"Business Buyer",role:"business",accountType:"business",businessType:"buyer",active:!0,createdAt:new Date(Date.now()-15*24*60*60*1e3)},{id:"demo-business-seller-1",email:"seller@company.com",displayName:"Business Seller",role:"business",accountType:"business",businessType:"seller",active:!0,createdAt:new Date(Date.now()-12*24*60*60*1e3)},{id:"demo-user-1",email:"user@company.com",displayName:"Regular User",role:"user",accountType:"user",active:!0,createdAt:new Date(Date.now()-10*24*60*60*1e3)}]}};d.useEffect(()=>{async function n(){try{j(!0);const c=(await O(L(p,"products"))).docs.map(t=>({id:t.id,...t.data()})),l=c.filter(t=>t.stock<=10).length,g=(await O(L(p,"orders"))).docs.map(t=>{const o=t.data();return{id:t.id,customerName:o.customerName||"Unknown Customer",total:o.total||0,status:o.status||"pending",createdAt:o.createdAt?o.createdAt.toDate():new Date}}),U=g.filter(t=>t.status==="pending").length,S=g.reduce((t,o)=>t+o.total,0),B=await N();y({totalUsers:B.length,totalOrders:g.length,totalRevenue:S,totalProducts:c.length,lowStockProducts:l,pendingOrders:U,allOrders:g,users:B}),j(!1)}catch(a){console.error("Error fetching admin data:",a),u("Failed to load admin data"),j(!1)}}n()},[]);const b=d.useCallback(async n=>{try{return await E(T(p,"users",n)),y(a=>({...a,users:a.users.filter(c=>c.id!==n),totalUsers:a.totalUsers-1})),Promise.resolve()}catch(a){throw console.error("Error deleting user:",a),new Error("Failed to delete user from database")}},[]),$=d.useCallback(async(n,a)=>{try{return await C(T(p,"users",n),{...a,updatedAt:new Date}),y(c=>({...c,users:c.users.map(l=>l.id===n?{...l,...a}:l)})),Promise.resolve()}catch(c){throw console.error("Error updating user role:",c),new Error("Failed to update user role in database")}},[]),R=d.useCallback(async()=>{try{const n=await N();y(a=>({...a,users:n,totalUsers:n.length}))}catch(n){console.error("Error refreshing users:",n)}},[]),f=d.useCallback(async(n,a)=>{try{const c=n.map(l=>{if(a==="delete")return E(T(p,"users",l));if(a==="activate")return C(T(p,"users",l),{active:!0});if(a==="deactivate")return C(T(p,"users",l),{active:!1})});return await Promise.all(c),y(l=>({...l,users:a==="delete"?l.users.filter(i=>!n.includes(i.id)):l.users.map(i=>n.includes(i.id)?{...i,active:a==="activate"}:i),totalUsers:a==="delete"?l.totalUsers-n.length:l.totalUsers})),Promise.resolve()}catch(c){throw new Error(`Failed to ${a} users: `+c.message)}},[]);return d.useCallback(async(n,a)=>{try{const c=n.map(l=>{if(a==="complete")return C(T(p,"orders",l),{status:"completed"});if(a==="cancel")return C(T(p,"orders",l),{status:"cancelled"});if(a==="export")return Promise.resolve()});if(await Promise.all(c),a==="export"){const l=s.allOrders.filter(S=>n.includes(S.id)),i=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),g=URL.createObjectURL(i),U=document.createElement("a");U.href=g,U.download=`orders-export-${new Date().toISOString().split("T")[0]}.json`,U.click(),URL.revokeObjectURL(g)}return D(`Bulk ${a} completed successfully`,"success"),Promise.resolve()}catch(c){throw new Error(`Failed to ${a} orders: `+c.message)}},[s.allOrders]),A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):w?e.jsx("div",{className:`container mx-auto px-4 py-8 ${r?"text-white":"text-gray-800"}`,children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500",children:w}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Retry"})]})}):e.jsxs("div",{className:`container mx-auto px-4 py-8 max-w-7xl ${r?"text-gray-200":"text-gray-800"}`,children:[m&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${m.type==="success"?r?"bg-green-900 border-green-700 text-green-100":"bg-green-100 border-green-400 text-green-800":r?"bg-red-900 border-red-700 text-red-100":"bg-red-100 border-red-400 text-red-800"} border`,children:m.message}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:`text-3xl font-bold ${r?"text-white":"text-gray-900"}`,children:"Admin Dashboard"}),e.jsx("p",{className:`mt-1 text-sm ${r?"text-gray-400":"text-gray-500"}`,children:"Manage users, monitor system health, and oversee platform operations"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[{title:"Total Users",value:s.totalUsers,icon:"👥",color:"blue"},{title:"Total Orders",value:s.totalOrders,icon:"📋",color:"green"},{title:"Total Revenue",value:`$${s.totalRevenue.toFixed(2)}`,icon:"💰",color:"indigo"},{title:"Pending Orders",value:s.pendingOrders,icon:"⏳",color:"yellow"}].map((n,a)=>e.jsx("div",{className:`${r?"bg-gray-800 border-gray-700":"bg-white border-gray-100"} rounded-xl shadow-md border p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${r?"text-gray-400":"text-gray-500"} uppercase tracking-wide`,children:n.title}),e.jsx("p",{className:`text-2xl font-bold ${r?"text-white":"text-gray-900"} mt-1`,children:n.value})]}),e.jsx("div",{className:`text-3xl p-3 rounded-full bg-${n.color}-${r?"900/30":"100"}`,children:n.icon})]})},a))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(J,{users:s.users,darkMode:r,onDeleteUser:b,onUpdateUserRole:$,onRefreshUsers:R,onBulkAction:f})}),e.jsx("div",{children:e.jsx(V,{darkMode:r})})]})]})};export{K as default};
